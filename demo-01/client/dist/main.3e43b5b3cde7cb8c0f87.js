!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=39)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(43))&&n.__esModule?n:{default:n};function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a="mediasoup-client",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=(0,o.default)("".concat(a,":").concat(t)),this._warn=(0,o.default)("".concat(a,":WARN:").concat(t)),this._error=(0,o.default)("".concat(a,":ERROR:").concat(t))):(this._debug=(0,o.default)(a),this._warn=(0,o.default)("".concat(a,":WARN")),this._error=(0,o.default)("".concat(a,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r,n;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&i(t.prototype,r),n&&i(t,n),e}();t.default=s},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.randomNumber=function(){return o()},t.clone=function(e){return JSON.parse(JSON.stringify(e))};var o=((n=r(49))&&n.__esModule?n:{default:n}).default.generator({min:1e7,max:99999999,integer:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=r(26),i=(n=r(0))&&n.__esModule?n:{default:n};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=c(this,u(t).call(this))).setMaxListeners(1/0),r._logger=e||new i.default("EnhancedEventEmitter"),r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o.EventEmitter),r=t,(n=[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:function(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return new Promise(function(r,o){t.safeEmit.apply(t,[e].concat(n,[function(e){r(e)},function(r){t._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",e,r),o(r)}]))})}}])&&s(r.prototype,n),a&&s(r,a),t}();t.default=l},function(e,t,r){"use strict";function n(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=function(){var e=a.value,n=(t.rtcpFeedback||[]).find(function(t){return t.type===e.type&&t.parameter===e.parameter});n&&r.push(n)},c=(e.rtcpFeedback||[])[Symbol.iterator]();!(n=(a=c.next()).done);n=!0)s()}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},o=!0,i=!1,a=void 0;try{for(var s,c=function(){var t=s.value;if("rtx"===t.name)return"continue";var o=(e.codecs||[]).find(function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if("video/h264"===r){var o=(e.parameters||{})["packetization-mode"]||0,i=(t.parameters||{})["packetization-mode"]||0;if(o!==i)return!1}return!0}(e,t)});if(o){var i={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:o.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:n(o,t),parameters:t.parameters};i.channels||delete i.channels,r.codecs.push(i)}},u=(t.codecs||[])[Symbol.iterator]();!(o=(s=u.next()).done);o=!0)c()}catch(e){i=!0,a=e}finally{try{o||null==u.return||u.return()}finally{if(i)throw a}}var d=!0,l=!1,p=void 0;try{for(var f,h=function(){var r=f.value,n=(e.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.sendPayloadType}),o=(t.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.recvPayloadType});n&&o&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=o.preferredPayloadType)},m=(r.codecs||[])[Symbol.iterator]();!(d=(f=m.next()).done);d=!0)h()}catch(e){l=!0,p=e}finally{try{d||null==m.return||m.return()}finally{if(l)throw p}}var y=!0,v=!1,g=void 0;try{for(var b,_=function(){var t=b.value,n=(e.headerExtensions||[]).find(function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n});if(n){var o={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(o)}},w=(t.headerExtensions||[])[Symbol.iterator]();!(y=(b=w.next()).done);y=!0)_()}catch(e){v=!0,g=e}finally{try{y||null==w.return||w.return()}finally{if(v)throw g}}return r},t.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var i,a=e.codecs[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value,c={name:s.name,mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvPayloadType,channels:s.channels,rtcpFeedback:s.rtcpFeedback,parameters:s.parameters};if(c.channels||delete c.channels,t.codecs.push(c),s.recvRtxPayloadType){var u={name:"rtx",mimeType:"".concat(s.kind,"/rtx"),kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvRtxPayloadType,parameters:{apt:s.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}var d=!0,l=!1,p=void 0;try{for(var f,h=e.headerExtensions[Symbol.iterator]();!(d=(f=h.next()).done);d=!0){var m=f.value,y={kind:m.kind,uri:m.uri,preferredId:m.recvId};t.headerExtensions.push(y)}}catch(e){l=!0,p=e}finally{try{d||null==h.return||h.return()}finally{if(l)throw p}}return t.fecMechanisms=e.fecMechanisms,t},t.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,i=r.codecs,a=!0,s=!1,c=void 0;try{for(var u,d=function(){var e=u.value;if(!i.some(function(t){return t.recvPayloadType===e})){var t=o.find(function(t){return t.preferredPayloadType===e});if(!t)throw new Error("mandatory codec PT ".concat(e," not found in remote codecs"));n.push(t)}},l=t[Symbol.iterator]();!(a=(u=l.next()).done);a=!0)d()}catch(e){s=!0,c=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}return n},t.canSend=function(e,t){return t.codecs.some(function(t){return t.kind===e})},t.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some(function(e){return e.recvPayloadType===r.payloadType})},t.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,i=void 0;try{for(var a,s=t.codecs[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.sendPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.sendRtxPayloadType){var d={name:"rtx",mimeType:"".concat(c.kind,"/rtx"),clockRate:c.clockRate,payloadType:c.sendRtxPayloadType,parameters:{apt:c.sendPayloadType}};r.codecs.push(d)}break}}}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}var l=!0,p=!1,f=void 0;try{for(var h,m=t.headerExtensions[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var y=h.value;if(!y.kind||y.kind===e){var v={uri:y.uri,id:y.sendId};r.headerExtensions.push(v)}}}catch(e){p=!0,f=e}finally{try{l||null==m.return||m.return()}finally{if(p)throw f}}return r},t.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,i=void 0;try{for(var a,s=t.codecs[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.recvRtxPayloadType){var d={name:"rtx",mimeType:"".concat(c.kind,"/rtx"),clockRate:c.clockRate,payloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};r.codecs.push(d)}}}}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}var l=!0,p=!1,f=void 0;try{for(var h,m=t.headerExtensions[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var y=h.value;if(!y.kind||y.kind===e){var v={uri:y.uri,id:y.recvId};r.headerExtensions.push(v)}}}catch(e){p=!0,f=e}finally{try{l||null==m.return||m.return()}finally{if(p)throw f}}return r}},function(e,t,r){var n=r(47),o=r(48);t.write=o,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractRtpCapabilities=function(e){var t=new Map,r=[],n=!1,i=!1,a=!0,s=!1,c=void 0;try{for(var u,d=e.media[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value,p=l.type;switch(p){case"audio":if(n)continue;n=!0;break;case"video":if(i)continue;i=!0;break;default:continue}var f=!0,h=!1,m=void 0;try{for(var y,v=l.rtp[Symbol.iterator]();!(f=(y=v.next()).done);f=!0){var g=y.value,b={name:g.codec,mimeType:"".concat(p,"/").concat(g.codec),kind:p,clockRate:g.rate,preferredPayloadType:g.payload,channels:g.encoding,rtcpFeedback:[],parameters:{}};"audio"!==b.kind?delete b.channels:b.channels||(b.channels=1),t.set(b.preferredPayloadType,b)}}catch(e){h=!0,m=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw m}}var _=!0,w=!1,P=void 0;try{for(var k,C=(l.fmtp||[])[Symbol.iterator]();!(_=(k=C.next()).done);_=!0){var S=k.value,R=o.default.parseFmtpConfig(S.config),T=t.get(S.payload);T&&(T.parameters=R)}}catch(e){w=!0,P=e}finally{try{_||null==C.return||C.return()}finally{if(w)throw P}}var O=!0,E=!1,x=void 0;try{for(var A,D=(l.rtcpFb||[])[Symbol.iterator]();!(O=(A=D.next()).done);O=!0){var j=A.value,F=t.get(j.payload);if(F){var I={type:j.type,parameter:j.subtype};I.parameter||delete I.parameter,F.rtcpFeedback.push(I)}}}catch(e){E=!0,x=e}finally{try{O||null==D.return||D.return()}finally{if(E)throw x}}var B=!0,L=!1,M=void 0;try{for(var U,N=(l.ext||[])[Symbol.iterator]();!(B=(U=N.next()).done);B=!0){var q=U.value,z={kind:p,uri:q.uri,preferredId:q.value};r.push(z)}}catch(e){L=!0,M=e}finally{try{B||null==N.return||N.return()}finally{if(L)throw M}}}}catch(e){s=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw c}}return{codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]}},t.extractDtlsParameters=function(e){var t,r=function(e){return(e.media||[]).find(function(e){return e.iceUfrag&&0!==e.port})}(e),n=r.fingerprint||e.fingerprint;switch(r.setup){case"active":t="client";break;case"passive":t="server";break;case"actpass":t="auto"}return{role:t,fingerprints:[{algorithm:n.type,value:n.hash}]}};var n,o=(n=r(4))&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(e,t,r){var n;if(null!=r){if(r=String(r),!(n=(e.media||[]).find(function(e){return String(e.mid)===r})))throw new Error("SDP section with mid=".concat(r," not found"))}else if(!(n=(e.media||[]).find(function(e){return e.type===t.kind&&e.msid&&e.msid.split(" ")[1]===t.id})))throw new Error("SDP section with a=msid containing track.id=".concat(t.id," not found"));return n}Object.defineProperty(t,"__esModule",{value:!0}),t.fillRtpParametersForTrack=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=i.mid,s=void 0===a?null:a,c=i.planBSimulcast,u=void 0!==c&&c,d=o(t,r,s);null!=s&&(e.muxId=String(s));e.rtcp={cname:null,reducedSize:!0,mux:!0};var l=(d.ssrcs||[]).find(function(e){return"cname"===e.attribute});if(!l)throw new Error("CNAME value not found");if(e.rtcp.cname=l.value,u){var p,f=new Set,h=!0,m=!1,y=void 0;try{for(var v,g=(d.ssrcs||[])[Symbol.iterator]();!(h=(v=g.next()).done);h=!0){var b=v.value;if("msid"===b.attribute){var _=b.id;f.add(_),p||(p=_)}}}catch(e){m=!0,y=e}finally{try{h||null==g.return||g.return()}finally{if(m)throw y}}if(0===f.size)throw new Error("no a=ssrc lines found");var w=new Map,P=!0,k=!1,C=void 0;try{for(var S,R=(d.ssrcGroups||[])[Symbol.iterator]();!(P=(S=R.next()).done);P=!0){var T=S.value;if("FID"===T.semantics){var O=T.ssrcs.split(/\s+/),E=n(O,2),x=E[0],A=E[1];x=Number(x),A=Number(A),f.has(x)&&(f.delete(x),f.delete(A),w.set(x,A))}}}catch(e){k=!0,C=e}finally{try{P||null==R.return||R.return()}finally{if(k)throw C}}var D=!0,j=!1,F=void 0;try{for(var I,B=f[Symbol.iterator]();!(D=(I=B.next()).done);D=!0){var L=I.value;w.set(L,null)}}catch(e){j=!0,F=e}finally{try{D||null==B.return||B.return()}finally{if(j)throw F}}e.encodings=[];var M=w.size>1,U=["low","medium","high"],N=!0,q=!1,z=void 0;try{for(var G,Y=w[Symbol.iterator]();!(N=(G=Y.next()).done);N=!0){var K=n(G.value,2),V=K[0],A=K[1],H={ssrc:V};A&&(H.rtx={ssrc:A}),M&&(H.profile=U.shift()),e.encodings.push(H)}}catch(e){q=!0,z=e}finally{try{N||null==Y.return||Y.return()}finally{if(q)throw z}}}else{var W=l.id,X=[],J=!0,Z=!1,Q=void 0;try{for(var $,ee=(d.rids||[])[Symbol.iterator]();!(J=($=ee.next()).done);J=!0){var te=$.value;"send"===te.direction&&(/^low/.test(te.id)?X.push({rid:te.id,profile:"low"}):/^medium/.test(te.id)&&X.push({rid:te.id,profile:"medium"}),/^high/.test(te.id)&&X.push({rid:te.id,profile:"high"}))}}catch(e){Z=!0,Q=e}finally{try{J||null==ee.return||ee.return()}finally{if(Z)throw Q}}if(e.encodings=[],0===X.length){var re={ssrc:W};e.encodings.push(re)}else for(var ne=0;ne<X.length;ne++){var oe=X[ne],ie={encodingId:oe.rid,profile:oe.profile};e.encodings.push(ie)}}},t.addPlanBSimulcast=function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).mid,n=o(e,t,void 0===r?null:r),i=(n.ssrcs||[]).find(function(e){return"msid"===e.attribute});if(!i)throw new Error("a=ssrc line with msid information not found");var a,s=i.id,c=i.value.split(" ")[0];(n.ssrcGroups||[]).some(function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===s?(a=Number(t[1]),!0):void 0}});var u=n.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===s});if(!u)throw new Error("CNAME line not found");var d=u.value,l=s+1,p=s+2;if(n.ssrcGroups=[],n.ssrcs=[],n.ssrcGroups.push({semantics:"SIM",ssrcs:"".concat(s," ").concat(l," ").concat(p)}),n.ssrcs.push({id:s,attribute:"cname",value:d}),n.ssrcs.push({id:s,attribute:"msid",value:"".concat(c," ").concat(t.id)}),n.ssrcs.push({id:l,attribute:"cname",value:d}),n.ssrcs.push({id:l,attribute:"msid",value:"".concat(c," ").concat(t.id)}),n.ssrcs.push({id:p,attribute:"cname",value:d}),n.ssrcs.push({id:p,attribute:"msid",value:"".concat(c," ").concat(t.id)}),a){var f=a+1,h=a+2;n.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(s," ").concat(a)}),n.ssrcs.push({id:a,attribute:"cname",value:d}),n.ssrcs.push({id:a,attribute:"msid",value:"".concat(c," ").concat(t.id)}),n.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(l," ").concat(f)}),n.ssrcs.push({id:f,attribute:"cname",value:d}),n.ssrcs.push({id:f,attribute:"msid",value:"".concat(c," ").concat(t.id)}),n.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(p," ").concat(h)}),n.ssrcs.push({id:h,attribute:"cname",value:d}),n.ssrcs.push({id:h,attribute:"msid",value:"".concat(c," ").concat(t.id)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(4)),o=a(r(0)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(1));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var m=new o.default("RemoteUnifiedPlanSdp"),y=function(){function e(t){p(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:i.randomNumber(),version:0}}return h(e,[{key:"setTransportLocalParameters",value:function(e){m.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){m.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){m.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,y),h(t,[{key:"createAnswerSdp",value:function(e){if(m.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,i={},a=(e.media||[]).filter(function(e){return e.hasOwnProperty("mid")}).map(function(e){return String(e.mid)});this._sdpGlobalFields.version++,i.version=0,i.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},i.name="-",i.timing={start:0,stop:0},i.icelite=t.iceLite?"ice-lite":null,i.msidSemantic={semantic:"WMS",token:"*"},a.length>0&&(i.groups=[{type:"BUNDLE",mids:a.join(" ")}]),i.media=[];var s=o.fingerprints.length;i.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=(e.media||[])[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,h="inactive"===f.direction,y=f.type,v=this._rtpParametersByKind[y].codecs,g=this._rtpParametersByKind[y].headerExtensions,b={};b.type=f.type,b.port=7,b.protocol="RTP/SAVPF",b.connection={ip:"127.0.0.1",version:4},b.mid=f.mid,b.iceUfrag=t.usernameFragment,b.icePwd=t.password,b.candidates=[];var _=!0,w=!1,P=void 0;try{for(var k,C=r[Symbol.iterator]();!(_=(k=C.next()).done);_=!0){var S=k.value,R={component:1};R.foundation=S.foundation,R.ip=S.ip,R.port=S.port,R.priority=S.priority,R.transport=S.protocol,R.type=S.type,S.tcpType&&(R.tcptype=S.tcpType),b.candidates.push(R)}}catch(e){w=!0,P=e}finally{try{_||null==C.return||C.return()}finally{if(w)throw P}}switch(b.endOfCandidates="end-of-candidates",b.iceOptions="renomination",o.role){case"client":b.setup="active";break;case"server":b.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":b.direction="recvonly";break;case"recvonly":case"inactive":b.direction="inactive"}b.rtp=[],b.rtcpFb=[],b.fmtp=[];var T=!0,O=!1,E=void 0;try{for(var x,A=v[Symbol.iterator]();!(T=(x=A.next()).done);T=!0){var D=x.value,j={payload:D.payloadType,codec:D.name,rate:D.clockRate};if(D.channels>1&&(j.encoding=D.channels),b.rtp.push(j),D.parameters){for(var F={payload:D.payloadType,config:""},I=Object.keys(D.parameters),B=0;B<I.length;B++){var L=I[B];F.config&&(F.config+=";"),F.config+="".concat(L,"=").concat(D.parameters[L])}F.config&&b.fmtp.push(F)}if(D.rtcpFeedback){var M=!0,U=!1,N=void 0;try{for(var q,z=D.rtcpFeedback[Symbol.iterator]();!(M=(q=z.next()).done);M=!0){var G=q.value;b.rtcpFb.push({payload:D.payloadType,type:G.type,subtype:G.parameter||""})}}catch(e){U=!0,N=e}finally{try{M||null==z.return||z.return()}finally{if(U)throw N}}}}}catch(e){O=!0,E=e}finally{try{T||null==A.return||A.return()}finally{if(O)throw E}}if(b.payloads=v.map(function(e){return e.payloadType}).join(" "),!h){b.ext=[];var Y=!0,K=!1,V=void 0;try{for(var H,W=function(){var e=H.value;if(!(f.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";b.ext.push({uri:e.uri,value:e.id})},X=g[Symbol.iterator]();!(Y=(H=X.next()).done);Y=!0)W()}catch(e){K=!0,V=e}finally{try{Y||null==X.return||X.return()}finally{if(K)throw V}}}if(f.simulcast_03){b.simulcast_03={value:f.simulcast_03.value.replace(/send/g,"recv")},b.rids=[];var J=!0,Z=!1,Q=void 0;try{for(var $,ee=(f.rids||[])[Symbol.iterator]();!(J=($=ee.next()).done);J=!0){var te=$.value;"send"===te.direction&&b.rids.push({id:te.id,direction:"recv"})}}catch(e){Z=!0,Q=e}finally{try{J||null==ee.return||ee.return()}finally{if(Z)throw Q}}}b.rtcpMux="rtcp-mux",b.rtcpRsize="rtcp-rsize",i.media.push(b)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(i)}}]),t}(),g=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,y),h(t,[{key:"createOfferSdp",value:function(e){if(m.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,i={},a=e.map(function(e){return String(e.mid)});this._sdpGlobalFields.version++,i.version=0,i.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},i.name="-",i.timing={start:0,stop:0},i.icelite=t.iceLite?"ice-lite":null,i.msidSemantic={semantic:"WMS",token:"*"},a.length>0&&(i.groups=[{type:"BUNDLE",mids:a.join(" ")}]),i.media=[];var s=o.fingerprints.length;i.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=e[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,h=f.closed,y=f.kind,v=void 0,g=void 0;"application"!==f.kind&&(v=this._rtpParametersByKind[y].codecs,g=this._rtpParametersByKind[y].headerExtensions);var b={};"application"!==f.kind?(b.type=y,b.port=7,b.protocol="RTP/SAVPF",b.connection={ip:"127.0.0.1",version:4},b.mid=f.mid,b.msid="".concat(f.streamId," ").concat(f.trackId)):(b.type=y,b.port=9,b.protocol="DTLS/SCTP",b.connection={ip:"127.0.0.1",version:4},b.mid=f.mid),b.iceUfrag=t.usernameFragment,b.icePwd=t.password,b.candidates=[];var _=!0,w=!1,P=void 0;try{for(var k,C=r[Symbol.iterator]();!(_=(k=C.next()).done);_=!0){var S=k.value,R={component:1};R.foundation=S.foundation,R.ip=S.ip,R.port=S.port,R.priority=S.priority,R.transport=S.protocol,R.type=S.type,S.tcpType&&(R.tcptype=S.tcpType),b.candidates.push(R)}}catch(e){w=!0,P=e}finally{try{_||null==C.return||C.return()}finally{if(w)throw P}}if(b.endOfCandidates="end-of-candidates",b.iceOptions="renomination",b.setup="actpass","application"!==f.kind){b.direction=h?"inactive":"sendonly",b.rtp=[],b.rtcpFb=[],b.fmtp=[];var T=!0,O=!1,E=void 0;try{for(var x,A=v[Symbol.iterator]();!(T=(x=A.next()).done);T=!0){var D=x.value,j={payload:D.payloadType,codec:D.name,rate:D.clockRate};if(D.channels>1&&(j.encoding=D.channels),b.rtp.push(j),D.parameters){for(var F={payload:D.payloadType,config:""},I=Object.keys(D.parameters),B=0;B<I.length;B++){var L=I[B];F.config&&(F.config+=";"),F.config+="".concat(L,"=").concat(D.parameters[L])}F.config&&b.fmtp.push(F)}if(D.rtcpFeedback){var M=!0,U=!1,N=void 0;try{for(var q,z=D.rtcpFeedback[Symbol.iterator]();!(M=(q=z.next()).done);M=!0){var G=q.value;b.rtcpFb.push({payload:D.payloadType,type:G.type,subtype:G.parameter||""})}}catch(e){U=!0,N=e}finally{try{M||null==z.return||z.return()}finally{if(U)throw N}}}}}catch(e){O=!0,E=e}finally{try{T||null==A.return||A.return()}finally{if(O)throw E}}if(b.payloads=v.map(function(e){return e.payloadType}).join(" "),!h){b.ext=[];var Y=!0,K=!1,V=void 0;try{for(var H,W=g[Symbol.iterator]();!(Y=(H=W.next()).done);Y=!0){var X=H.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==X.uri&&b.ext.push({uri:X.uri,value:X.id})}}catch(e){K=!0,V=e}finally{try{Y||null==W.return||W.return()}finally{if(K)throw V}}}b.rtcpMux="rtcp-mux",b.rtcpRsize="rtcp-rsize",h||(b.ssrcs=[],b.ssrcGroups=[],b.ssrcs.push({id:f.ssrc,attribute:"cname",value:f.cname}),f.rtxSsrc&&(b.ssrcs.push({id:f.rtxSsrc,attribute:"cname",value:f.cname}),b.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(f.ssrc," ").concat(f.rtxSsrc)})))}else b.payloads=5e3,b.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};i.media.push(b)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(i)}}]),t}();t.default=function e(t,r){switch(p(this,e),m.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new v(r);case"recv":return new g(r)}}},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(t,"__esModule",{value:!0}),t.fillRtpParametersForTrack=function(e,t,r){var o,i=r.kind,a={cname:null,reducedSize:!0,mux:!0},s=(t.media||[]).find(function(e){return e.type===i});if(!s)throw new Error("m=".concat(i," section not found"));var c=new Set,u=!0,d=!1,l=void 0;try{for(var p,f=(s.ssrcs||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value;if("msid"===h.attribute){var m=h.value.split(" ")[1];if(m===r.id){var y=h.id;c.add(y),o||(o=y)}}}}catch(e){d=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(d)throw l}}if(0===c.size)throw new Error("a=ssrc line not found for local track [track.id:".concat(r.id,"]"));var v=new Map,g=!0,b=!1,_=void 0;try{for(var w,P=(s.ssrcGroups||[])[Symbol.iterator]();!(g=(w=P.next()).done);g=!0){var k=w.value;if("FID"===k.semantics){var C=k.ssrcs.split(/\s+/),S=n(C,2),R=S[0],T=S[1];R=Number(R),T=Number(T),c.has(R)&&(c.delete(R),c.delete(T),v.set(R,T))}}}catch(e){b=!0,_=e}finally{try{g||null==P.return||P.return()}finally{if(b)throw _}}var O=!0,E=!1,x=void 0;try{for(var A,D=c[Symbol.iterator]();!(O=(A=D.next()).done);O=!0){var j=A.value;v.set(j,null)}}catch(e){E=!0,x=e}finally{try{O||null==D.return||D.return()}finally{if(E)throw x}}var F=s.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===o});F&&(a.cname=F.value);e.rtcp=a,e.encodings=[];var I=v.size>1,B=["low","medium","high"],L=!0,M=!1,U=void 0;try{for(var N,q=v[Symbol.iterator]();!(L=(N=q.next()).done);L=!0){var z=n(N.value,2),G=z[0],T=z[1],Y={ssrc:G};T&&(Y.rtx={ssrc:T}),I&&(Y.profile=B.shift()),e.encodings.push(Y)}}catch(e){M=!0,U=e}finally{try{L||null==q.return||q.return()}finally{if(M)throw U}}},t.addSimulcastForTrack=function(e,t){var r,n,o,i=t.kind,a=(e.media||[]).find(function(e){return e.type===i});if(!a)throw new Error("m=".concat(i," section not found"));if(!(a.ssrcs||[]).find(function(e){if("msid"!==e.attribute)return!1;var n=e.value.split(" ")[1];return n===t.id?(r=e.id,o=e.value.split(" ")[0],!0):void 0}))throw new Error("a=ssrc line not found for local track [track.id:".concat(t.id,"]"));(a.ssrcGroups||[]).some(function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===r?(n=Number(t[1]),!0):void 0}});var s=a.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===r});if(!s)throw new Error("CNAME line not found for local track [track.id:".concat(t.id,"]"));var c=s.value,u=r+1,d=r+2;if(a.ssrcGroups=a.ssrcGroups||[],a.ssrcGroups.push({semantics:"SIM",ssrcs:"".concat(r," ").concat(u," ").concat(d)}),a.ssrcs.push({id:u,attribute:"cname",value:c}),a.ssrcs.push({id:u,attribute:"msid",value:"".concat(o," ").concat(t.id)}),a.ssrcs.push({id:d,attribute:"cname",value:c}),a.ssrcs.push({id:d,attribute:"msid",value:"".concat(o," ").concat(t.id)}),n){var l=n+1,p=n+2;a.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(u," ").concat(l)}),a.ssrcs.push({id:l,attribute:"cname",value:c}),a.ssrcs.push({id:l,attribute:"msid",value:"".concat(o," ").concat(t.id)}),a.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(d," ").concat(p)}),a.ssrcs.push({id:p,attribute:"cname",value:c}),a.ssrcs.push({id:p,attribute:"msid",value:"".concat(o," ").concat(t.id)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(4)),o=a(r(0)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(1));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var m=new o.default("RemotePlanBSdp"),y=function(){function e(t){p(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:i.randomNumber(),version:0}}return h(e,[{key:"setTransportLocalParameters",value:function(e){m.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){m.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){m.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,y),h(t,[{key:"createAnswerSdp",value:function(e){if(m.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,i={},a=(e.media||[]).map(function(e){return String(e.mid)});this._sdpGlobalFields.version++,i.version=0,i.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},i.name="-",i.timing={start:0,stop:0},i.icelite=t.iceLite?"ice-lite":null,i.msidSemantic={semantic:"WMS",token:"*"},i.groups=[{type:"BUNDLE",mids:a.join(" ")}],i.media=[];var s=o.fingerprints.length;i.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=(e.media||[])[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,h=f.type,y=this._rtpParametersByKind[h].codecs,v=this._rtpParametersByKind[h].headerExtensions,g={};g.type=f.type,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid,g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,_=!1,w=void 0;try{for(var P,k=r[Symbol.iterator]();!(b=(P=k.next()).done);b=!0){var C=P.value,S={component:1};S.foundation=C.foundation,S.ip=C.ip,S.port=C.port,S.priority=C.priority,S.transport=C.protocol,S.type=C.type,C.tcpType&&(S.tcptype=C.tcpType),g.candidates.push(S)}}catch(e){_=!0,w=e}finally{try{b||null==k.return||k.return()}finally{if(_)throw w}}switch(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",o.role){case"client":g.setup="active";break;case"server":g.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":g.direction="recvonly";break;case"recvonly":case"inactive":g.direction="inactive"}"video"===h&&(g.xGoogleFlag="conference"),g.rtp=[],g.rtcpFb=[],g.fmtp=[];var R=!0,T=!1,O=void 0;try{for(var E,x=y[Symbol.iterator]();!(R=(E=x.next()).done);R=!0){var A=E.value,D={payload:A.payloadType,codec:A.name,rate:A.clockRate};if(A.channels>1&&(D.encoding=A.channels),g.rtp.push(D),A.parameters){for(var j={payload:A.payloadType,config:""},F=Object.keys(A.parameters),I=0;I<F.length;I++){var B=F[I];j.config&&(j.config+=";"),j.config+="".concat(B,"=").concat(A.parameters[B])}j.config&&g.fmtp.push(j)}if(A.rtcpFeedback){var L=!0,M=!1,U=void 0;try{for(var N,q=A.rtcpFeedback[Symbol.iterator]();!(L=(N=q.next()).done);L=!0){var z=N.value;g.rtcpFb.push({payload:A.payloadType,type:z.type,subtype:z.parameter||""})}}catch(e){M=!0,U=e}finally{try{L||null==q.return||q.return()}finally{if(M)throw U}}}}}catch(e){T=!0,O=e}finally{try{R||null==x.return||x.return()}finally{if(T)throw O}}g.payloads=y.map(function(e){return e.payloadType}).join(" "),g.ext=[];var G=!0,Y=!1,K=void 0;try{for(var V,H=function(){var e=V.value;if(!(f.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";g.ext.push({uri:e.uri,value:e.id})},W=v[Symbol.iterator]();!(G=(V=W.next()).done);G=!0)H()}catch(e){Y=!0,K=e}finally{try{G||null==W.return||W.return()}finally{if(Y)throw K}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",i.media.push(g)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(i)}}]),t}(),g=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,y),h(t,[{key:"createOfferSdp",value:function(e,t){var r=this;if(m.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var o=this._transportRemoteParameters.iceParameters,i=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,s={},c=e;this._sdpGlobalFields.version++,s.version=0,s.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},s.name="-",s.timing={start:0,stop:0},s.icelite=o.iceLite?"ice-lite":null,s.msidSemantic={semantic:"WMS",token:"*"},s.groups=[{type:"BUNDLE",mids:c.join(" ")}],s.media=[];var u=a.fingerprints.length;s.fingerprint={type:a.fingerprints[u-1].algorithm,hash:a.fingerprints[u-1].value};var d=!0,l=!1,p=void 0;try{for(var f,h=function(){var e=f.value,n=r._rtpParametersByKind[e].codecs,a=r._rtpParametersByKind[e].headerExtensions,c={};c.type=e,c.port=7,c.protocol="RTP/SAVPF",c.connection={ip:"127.0.0.1",version:4},c.mid=e,c.iceUfrag=o.usernameFragment,c.icePwd=o.password,c.candidates=[];var u=!0,d=!1,l=void 0;try{for(var p,h=i[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var m=p.value,y={component:1};y.foundation=m.foundation,y.ip=m.ip,y.port=m.port,y.priority=m.priority,y.transport=m.protocol,y.type=m.type,m.tcpType&&(y.tcptype=m.tcpType),c.candidates.push(y)}}catch(e){d=!0,l=e}finally{try{u||null==h.return||h.return()}finally{if(d)throw l}}c.endOfCandidates="end-of-candidates",c.iceOptions="renomination",c.setup="actpass",t.some(function(t){return t.kind===e})?c.direction="sendonly":c.direction="inactive",c.rtp=[],c.rtcpFb=[],c.fmtp=[];var v=!0,g=!1,b=void 0;try{for(var _,w=n[Symbol.iterator]();!(v=(_=w.next()).done);v=!0){var P=_.value,k={payload:P.payloadType,codec:P.name,rate:P.clockRate};if(P.channels>1&&(k.encoding=P.channels),c.rtp.push(k),P.parameters){for(var C={payload:P.payloadType,config:""},S=Object.keys(P.parameters),R=0;R<S.length;R++){var T=S[R];C.config&&(C.config+=";"),C.config+="".concat(T,"=").concat(P.parameters[T])}C.config&&c.fmtp.push(C)}if(P.rtcpFeedback){var O=!0,E=!1,x=void 0;try{for(var A,D=P.rtcpFeedback[Symbol.iterator]();!(O=(A=D.next()).done);O=!0){var j=A.value;c.rtcpFb.push({payload:P.payloadType,type:j.type,subtype:j.parameter||""})}}catch(e){E=!0,x=e}finally{try{O||null==D.return||D.return()}finally{if(E)throw x}}}}}catch(e){g=!0,b=e}finally{try{v||null==w.return||w.return()}finally{if(g)throw b}}c.payloads=n.map(function(e){return e.payloadType}).join(" "),c.ext=[];var F=!0,I=!1,B=void 0;try{for(var L,M=a[Symbol.iterator]();!(F=(L=M.next()).done);F=!0){var U=L.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==U.uri&&c.ext.push({uri:U.uri,value:U.id})}}catch(e){I=!0,B=e}finally{try{F||null==M.return||M.return()}finally{if(I)throw B}}c.rtcpMux="rtcp-mux",c.rtcpRsize="rtcp-rsize",c.ssrcs=[],c.ssrcGroups=[];var N=!0,q=!1,z=void 0;try{for(var G,Y=t[Symbol.iterator]();!(N=(G=Y.next()).done);N=!0){var K=G.value;K.kind===e&&(c.ssrcs.push({id:K.ssrc,attribute:"msid",value:"".concat(K.streamId," ").concat(K.trackId)}),c.ssrcs.push({id:K.ssrc,attribute:"mslabel",value:K.streamId}),c.ssrcs.push({id:K.ssrc,attribute:"label",value:K.trackId}),c.ssrcs.push({id:K.ssrc,attribute:"cname",value:K.cname}),K.rtxSsrc&&(c.ssrcs.push({id:K.rtxSsrc,attribute:"msid",value:"".concat(K.streamId," ").concat(K.trackId)}),c.ssrcs.push({id:K.rtxSsrc,attribute:"mslabel",value:K.streamId}),c.ssrcs.push({id:K.rtxSsrc,attribute:"label",value:K.trackId}),c.ssrcs.push({id:K.rtxSsrc,attribute:"cname",value:K.cname}),c.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(K.ssrc," ").concat(K.rtxSsrc)})))}}catch(e){q=!0,z=e}finally{try{N||null==Y.return||Y.return()}finally{if(q)throw z}}s.media.push(c)},y=e[Symbol.iterator]();!(d=(f=y.next()).done);d=!0)h()}catch(e){l=!0,p=e}finally{try{d||null==y.return||y.return()}finally{if(l)throw p}}return n.default.write(s)}}]),t}();t.default=function e(t,r){switch(p(this,e),m.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new v(r);case"recv":return new g(r)}}},function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<n.length;o++)if((r=n[o])===t||r.fn===t){n.splice(o,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,o=(r=r.slice(0)).length;n<o;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){var n,o=r(83),i=r(33),a=r(85),s=r(86),c=r(87);"undefined"!=typeof ArrayBuffer&&(n=r(88));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),d="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=u||d;t.protocol=3;var p=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=o(p),h={type:"error",data:"parser error"},m=r(89);function y(e,t,r){for(var n=new Array(e.length),o=s(e.length,r),i=function(e,r,o){t(r,function(t,r){n[e]=r,o(t,n)})},a=0;a<e.length;a++)i(a,e[a],o)}t.encodePacket=function(e,r,n,o){"function"==typeof r&&(o=r,r=!1),"function"==typeof n&&(o=n,n=null);var i=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&i instanceof ArrayBuffer)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var o=e.data,i=new Uint8Array(o),a=new Uint8Array(1+o.byteLength);a[0]=p[e.type];for(var s=0;s<i.length;s++)a[s+1]=i[s];return n(a.buffer)}(e,r,o);if(void 0!==m&&i instanceof m)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);if(l)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var o=new FileReader;return o.onload=function(){t.encodePacket({type:e.type,data:o.result},r,!0,n)},o.readAsArrayBuffer(e.data)}(e,r,n);var o=new Uint8Array(1);o[0]=p[e.type];var i=new m([o.buffer,e.data]);return n(i)}(e,r,o);if(i&&i.base64)return function(e,r){var n="b"+t.packets[e.type]+e.data.data;return r(n)}(e,o);var a=p[e.type];return void 0!==e.data&&(a+=n?c.encode(String(e.data),{strict:!1}):String(e.data)),o(""+a)},t.encodeBase64Packet=function(e,r){var n,o="b"+t.packets[e.type];if(void 0!==m&&e.data instanceof m){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];r(o+e)},i.readAsDataURL(e.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var a=new Uint8Array(e.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];n=String.fromCharCode.apply(null,s)}return o+=btoa(n),r(o)},t.decodePacket=function(e,r,n){if(void 0===e)return h;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),r);if(n&&!1===(e=function(e){try{e=c.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return h;var o=e.charAt(0);return Number(o)==o&&f[o]?e.length>1?{type:f[o],data:e.substring(1)}:{type:f[o]}:h}o=new Uint8Array(e)[0];var i=a(e,1);return m&&"blob"===r&&(i=new m([i])),{type:f[o],data:i}},t.decodeBase64Packet=function(e,t){var r=f[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var o=n.decode(e.substr(1));return"blob"===t&&m&&(o=new m([o])),{type:r,data:o}},t.encodePayload=function(e,r,n){"function"==typeof r&&(n=r,r=null);var o=i(e);if(r&&o)return m&&!l?t.encodePayloadAsBlob(e,n):t.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");y(e,function(e,n){t.encodePacket(e,!!o&&r,!1,function(e){n(null,function(e){return e.length+":"+e}(e))})},function(e,t){return n(t.join(""))})},t.decodePayload=function(e,r,n){if("string"!=typeof e)return t.decodePayloadAsBinary(e,r,n);var o;if("function"==typeof r&&(n=r,r=null),""===e)return n(h,0,1);for(var i,a,s="",c=0,u=e.length;c<u;c++){var d=e.charAt(c);if(":"===d){if(""===s||s!=(i=Number(s)))return n(h,0,1);if(s!=(a=e.substr(c+1,i)).length)return n(h,0,1);if(a.length){if(o=t.decodePacket(a,r,!1),h.type===o.type&&h.data===o.data)return n(h,0,1);if(!1===n(o,c+i,u))return}c+=i,s=""}else s+=d}return""!==s?n(h,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,r){if(!e.length)return r(new ArrayBuffer(0));y(e,function(e,r){t.encodePacket(e,!0,!0,function(e){return r(null,e)})},function(e,t){var n=t.reduce(function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2},0),o=new Uint8Array(n),i=0;return t.forEach(function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);r=n.buffer}o[i++]=t?0:1;var s=r.byteLength.toString();for(a=0;a<s.length;a++)o[i++]=parseInt(s[a]);o[i++]=255;for(n=new Uint8Array(r),a=0;a<n.length;a++)o[i++]=n[a]}),r(o.buffer)})},t.encodePayloadAsBlob=function(e,r){y(e,function(e,r){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);e=n.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)a[o]=parseInt(i[o]);if(a[i.length]=255,m){var s=new m([t.buffer,a.buffer,e]);r(null,s)}})},function(e,t){return r(new m(t))})},t.decodePayloadAsBinary=function(e,r,n){"function"==typeof r&&(n=r,r=null);for(var o=e,i=[];o.byteLength>0;){for(var s=new Uint8Array(o),c=0===s[0],u="",d=1;255!==s[d];d++){if(u.length>310)return n(h,0,1);u+=s[d]}o=a(o,2+u.length),u=parseInt(u);var l=a(o,0,u);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(e){var p=new Uint8Array(l);l="";for(d=0;d<p.length;d++)l+=String.fromCharCode(p[d])}i.push(l),o=a(o,u)}var f=i.length;i.forEach(function(e,o){n(t.decodePacket(e,r,!0),o,f)})}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?s(e):t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,e)})(e)}function u(e,t,r){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&d(o,r.prototype),o}).apply(null,arguments)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.UnsupportedError=t.TimeoutError=t.InvalidStateError=void 0;var p=function(e){function t(e){var r;return o(this,t),(r=i(this,l(t).call(this,e))).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(s(s(r)),t):r.stack=new Error(e).stack,r}return a(t,c(Error)),t}();t.InvalidStateError=p;var f=function(e){function t(e){var r;return o(this,t),(r=i(this,l(t).call(this,e))).name="TimeoutError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(s(s(r)),t):r.stack=new Error(e).stack,r}return a(t,c(Error)),t}();t.TimeoutError=f;var h=function(e){function t(e,r){var n;return o(this,t),(n=i(this,l(t).call(this,e))).name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(s(s(n)),t):n.stack=new Error(e).stack,n.data=r,n}return a(t,c(Error)),t}();t.UnsupportedError=h},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c,u=[],d=!1,l=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):l=-1,u.length&&f())}function f(){if(!d){var e=s(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||d||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){(function(n){function o(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(t=e.exports=r(72)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,n)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=o,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(o())}).call(this,r(13))},function(e,t){t.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},t.decode=function(e){for(var t={},r=e.split("&"),n=0,o=r.length;n<o;n++){var i=r[n].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},function(e,t){e.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){(function(n){function o(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(t=e.exports=r(90)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,n)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=o,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(o())}).call(this,r(13))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=y(r(41)),o=y(r(0)),i=y(r(46)),a=y(r(50)),s=y(r(51)),c=y(r(52)),u=y(r(53)),d=y(r(54)),l=y(r(55)),p=y(r(56)),f=y(r(57)),h=y(r(58)),m=y(r(60));function y(e){return e&&e.__esModule?e:{default:e}}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g=new o.default("Device"),b=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}var r,o,y;return r=t,y=[{key:"setHandler",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t._detected=!0,t._handlerClass=e,t._flag=r.flag,t._name=r.name,t._version=r.version,t._bowser=r.bowser||{}}},{key:"getFlag",value:function(){return t._detected||t._detect(),t._flag}},{key:"getName",value:function(){return t._detected||t._detect(),t._name}},{key:"getVersion",value:function(){return t._detected||t._detect(),t._version}},{key:"getBowser",value:function(){return t._detected||t._detect(),t._bowser}},{key:"isSupported",value:function(){return t._detected||t._detect(),Boolean(t._handlerClass)}},{key:"_detect",value:function(){if(t._detected=!0,e.navigator&&"ReactNative"===e.navigator.product)t._flag="react-native",t._name="ReactNative",t._version=void 0,t._bowser={},t._handlerClass=m.default;else if(e.navigator&&"string"==typeof e.navigator.userAgent){var r=e.navigator.userAgent,o=n.default.detect(r);t._flag=void 0,t._name=o.name||void 0,t._version=o.version||void 0,t._bowser=o,t._handlerClass=null,n.default.check({chrome:"70",chromium:"70"},!0,r)?(t._flag="chrome",t._handlerClass=i.default):n.default.check({chrome:"69",chromium:"69"},!0,r)?(t._flag="chrome",t._handlerClass=a.default):n.default.check({chrome:"67",chromium:"67"},!0,r)?(t._flag="chrome",t._handlerClass=s.default):n.default.check({chrome:"55",chromium:"55"},!0,r)?(t._flag="chrome",t._handlerClass=c.default):n.default.check({firefox:"65"},!0,r)?(t._flag="firefox",t._handlerClass=l.default):n.default.check({firefox:"59"},!0,r)?(t._flag="firefox",t._handlerClass=p.default):n.default.check({firefox:"50"},!0,r)?(t._flag="firefox",t._handlerClass=f.default):n.default.check({safari:"12.1"},!0,r)?(t._flag="safari",t._handlerClass=u.default):n.default.check({safari:"11"},!0,r)?(t._flag="safari",t._handlerClass=d.default):n.default.check({msedge:"11"},!0,r)?(t._flag="msedge",t._handlerClass=h.default):n.default.check({opera:"57"},!0,r)?(t._flag="opera",t._handlerClass=i.default):n.default.check({opera:"44"},!0,r)&&(t._flag="opera",t._handlerClass=c.default),t.isSupported()?g.debug('browser supported [flag:%s, name:"%s", version:%s, handler:%s]',t._flag,t._name,t._version,t._handlerClass.tag):g.warn("browser not supported [name:%s, version:%s]",t._name,t._version)}else g.warn("device not supported")}},{key:"Handler",get:function(){return t._detected||t._detect(),t._handlerClass}}],(o=null)&&v(r.prototype,o),y&&v(r,y),t}();t.default=b,b._detected=!1,b._flag=void 0,b._name=void 0,b._version=void 0,b._bowser=void 0,b._handlerClass=null}).call(this,r(19))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){var r=1e3,n=60*r,o=60*n,i=24*o,a=365.25*i;function s(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var c,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return s*a;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*o;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?s(c=e,i,"day")||s(c,o,"hour")||s(c,n,"minute")||s(c,r,"second")||c+" ms":function(e){if(e>=i)return Math.round(e/i)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=n)return Math.round(e/n)+"m";if(e>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){var n=r(73)("socket.io-parser"),o=r(10),i=r(75),a=r(28),s=r(29);function c(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=l;var u=t.ERROR+'"encode error"';function d(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var o=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===o)return u;r+=o}return n("encoded %j as %s",e,r),r}function l(){this.reconstructor=null}function p(e){this.reconPack=e,this.buffers=[]}function f(e){return{type:t.ERROR,data:"parser error: "+e}}c.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){i.removeBlobs(e,function(e){var r=i.deconstructPacket(e),n=d(r.packet),o=r.buffers;o.unshift(n),t(o)})}(e,r):r([d(e)])},o(l.prototype),l.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])return f("unknown packet type "+o.type);if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(var i="";"-"!==e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!==e.charAt(r))throw new Error("Illegal attachments");o.attachments=Number(i)}if("/"===e.charAt(r+1))for(o.nsp="";++r;){var s=e.charAt(r);if(","===s)break;if(o.nsp+=s,r===e.length)break}else o.nsp="/";var c=e.charAt(r+1);if(""!==c&&Number(c)==c){for(o.id="";++r;){var s=e.charAt(r);if(null==s||Number(s)!=s){--r;break}if(o.id+=e.charAt(r),r===e.length)break}o.id=Number(o.id)}if(e.charAt(++r)){var u=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r)),d=!1!==u&&(o.type===t.ERROR||a(u));if(!d)return f("invalid payload");o.data=u}return n("decoded %s as %j",e,o),o}(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new p(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!s(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},p.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=i.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},p.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(76),o=r(77),i=r(78);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=p(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|h(t,r),o=(e=s(e,n)).write(t,r);o!==n&&(e=e.slice(0,o));return e}(e,t,r):function(e,t){if(c.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):p(e,t);if("Buffer"===t.type&&i(t.data))return p(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(d(t),e=s(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function p(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function h(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return q(e).length;default:if(n)return N(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,o);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,o){var i,a=1,s=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(o){var d=-1;for(i=r;i<s;i++)if(u(e,i)===u(t,-1===d?0:i-d)){if(-1===d&&(d=i),i-d+1===c)return d*a}else-1!==d&&(i-=i-d),d=-1}else for(r+c>s&&(r=s-c),i=r;i>=0;i--){for(var l=!0,p=0;p<c;p++)if(u(e,i+p)!==u(t,p)){l=!1;break}if(l)return i}return-1}function g(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function b(e,t,r,n){return z(N(t,e.length-r),e,r,n)}function _(e,t,r,n){return z(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function w(e,t,r,n){return _(e,t,r,n)}function P(e,t,r,n){return z(q(t),e,r,n)}function k(e,t,r,n){return z(function(e,t){for(var r,n,o,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(t,e.length-r),e,r,n)}function C(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function S(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,a,s,c,u=e[o],d=null,l=u>239?4:u>223?3:u>191?2:1;if(o+l<=r)switch(l){case 1:u<128&&(d=u);break;case 2:128==(192&(i=e[o+1]))&&(c=(31&u)<<6|63&i)>127&&(d=c);break;case 3:i=e[o+1],a=e[o+2],128==(192&i)&&128==(192&a)&&(c=(15&u)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(d=c);break;case 4:i=e[o+1],a=e[o+2],s=e[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(d=c)}null===d?(d=65533,l=1):d>65535&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|1023&d),n.push(d),o+=l}return function(e){var t=e.length;if(t<=R)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=R));return r}(n)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,r){return u(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,r){return function(e,t,r,n){return d(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},c.allocUnsafe=function(e){return l(null,e)},c.allocUnsafeSlow=function(e){return l(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var a=e[r];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,o),o+=a.length}return n},c.byteLength=h,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return E(this,t,r);case"utf8":case"utf-8":return S(this,t,r);case"ascii":return T(this,t,r);case"latin1":case"binary":return O(this,t,r);case"base64":return C(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,o){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(i,a),u=this.slice(n,o),d=e.slice(t,r),l=0;l<s;++l)if(u[l]!==d[l]){i=u[l],a=d[l];break}return i<a?-1:a<i?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":return _(this,e,t,r);case"latin1":case"binary":return w(this,e,t,r);case"base64":return P(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var R=4096;function T(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function O(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function E(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=t;i<r;++i)o+=U(e[i]);return o}function x(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function A(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,r,n,o,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function j(e,t,r,n){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-r,2);o<i;++o)e[r+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function F(e,t,r,n){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-r,4);o<i;++o)e[r+o]=t>>>8*(n?o:3-o)&255}function I(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(e,t,r,n,i){return i||I(e,0,r,4),o.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,i){return i||I(e,0,r,8),o.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=c.prototype;else{var o=t-e;r=new c(o,void 0);for(var i=0;i<o;++i)r[i]=this[i+e]}return r},c.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||A(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},c.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||A(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},c.prototype.readUInt8=function(e,t){return t||A(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||A(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||A(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||A(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||A(e,t,this.length);for(var n=t,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||A(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){t||A(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||A(e,4,this.length),o.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||A(e,4,this.length),o.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||A(e,8,this.length),o.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||A(e,8,this.length),o.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||D(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||D(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):F(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);D(this,e,t,r,o-1,-o)}var i=0,a=1,s=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);D(this,e,t,r,o-1,-o)}var i=r-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):F(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o,i=n-r;if(this===e&&r<t&&t<n)for(o=i-1;o>=0;--o)e[o+t]=this[o+r];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+i),t);return i},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=c.isBuffer(e)?e:N(new c(e,n).toString()),s=a.length;for(i=0;i<r-t;++i)this[i+t]=a[i%s]}return this};var M=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function N(e,t){var r;t=t||1/0;for(var n=e.length,o=null,i=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function q(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}}).call(this,r(19))},function(e,t,r){var n=r(81);e.exports=function(e){var t=e.xdomain,r=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&o)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},function(e,t,r){var n=r(11),o=r(10);function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=i,o(i.prototype),i.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},i.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){r[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,a,s,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(i(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(o(r))for(s=Array.prototype.slice.call(arguments,1),a=(u=r.slice()).length,c=0;c<a;c++)u[c].apply(this,s);return!0},r.prototype.addListener=function(e,t){var a;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(a=i(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function o(){this.removeListener(e,o),r||(r=!0,t.apply(this,arguments))}return o.listener=t,this.on(e,o),this},r.prototype.removeListener=function(e,t){var r,i,a,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(r=this._events[e]).length,i=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(s=a;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){i=s;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,o=e.indexOf("["),i=e.indexOf("]");-1!=o&&-1!=i&&(e=e.substring(0,o)+e.substring(o,i).replace(/:/g,";")+e.substring(i,e.length));for(var a=r.exec(e||""),s={},c=14;c--;)s[n[c]]=a[c]||"";return-1!=o&&-1!=i&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){(function(t){e.exports=function(e){return r&&t.isBuffer(e)||n&&(e instanceof ArrayBuffer||o(e))};var r="function"==typeof t&&"function"==typeof t.isBuffer,n="function"==typeof ArrayBuffer,o=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}}).call(this,r(22).Buffer)},function(e,t,r){var n=r(79),o=r(36),i=r(10),a=r(21),s=r(37),c=r(38),u=r(14)("socket.io-client:manager"),d=r(35),l=r(95),p=Object.prototype.hasOwnProperty;function f(e,t){if(!(this instanceof f))return new f(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||a;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=f,f.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},f.prototype.updateSocketIds=function(){for(var e in this.nsps)p.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},f.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},i(f.prototype),f.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},f.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},f.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},f.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},f.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},f.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},f.prototype.open=f.prototype.connect=function(e,t){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var i=s(r,"open",function(){o.onopen(),e&&e()}),a=s(r,"error",function(t){if(u("connect_error"),o.cleanup(),o.readyState="closed",o.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else o.maybeReconnectOnOpen()});if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var d=setTimeout(function(){u("connect attempt timed out after %d",c),i.destroy(),r.close(),r.emit("error","timeout"),o.emitAll("connect_timeout",c)},c);this.subs.push({destroy:function(){clearTimeout(d)}})}return this.subs.push(i),this.subs.push(a),this},f.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(s(e,"data",c(this,"ondata"))),this.subs.push(s(e,"ping",c(this,"onping"))),this.subs.push(s(e,"pong",c(this,"onpong"))),this.subs.push(s(e,"error",c(this,"onerror"))),this.subs.push(s(e,"close",c(this,"onclose"))),this.subs.push(s(this.decoder,"decoded",c(this,"ondecoded")))},f.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},f.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},f.prototype.ondata=function(e){this.decoder.add(e)},f.prototype.ondecoded=function(e){this.emit("packet",e)},f.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},f.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new o(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",i),r.on("connect",function(){r.id=n.generateId(e)}),this.autoConnect&&i()}function i(){~d(n.connecting,r)||n.connecting.push(r)}return r},f.prototype.destroy=function(e){var t=d(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},f.prototype.packet=function(e){u("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},f.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},f.prototype.cleanup=function(){u("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},f.prototype.close=f.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},f.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},f.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,r){var n=r(23),o=r(82),i=r(91),a=r(92);t.polling=function(e){var t=!1,r=!1,a=!1!==e.jsonp;if("undefined"!=typeof location){var s="https:"===location.protocol,c=location.port;c||(c=s?443:80),t=e.hostname!==location.hostname||c!==e.port,r=e.secure!==s}if(e.xdomain=t,e.xscheme=r,"open"in new n(e)&&!e.forceJSONP)return new o(e);if(!a)throw new Error("JSONP disabled");return new i(e)},t.websocket=a},function(e,t,r){var n=r(24),o=r(15),i=r(11),a=r(16),s=r(34),c=r(17)("engine.io-client:polling");e.exports=d;var u=null!=new(r(23))({xdomain:!1}).responseType;function d(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),n.call(this,e)}a(d,n),d.prototype.name="polling",d.prototype.doOpen=function(){this.poll()},d.prototype.pause=function(e){var t=this;function r(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(c("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){c("pre-pause polling complete"),--n||r()})),this.writable||(c("we are currently writing - waiting to pause"),n++,this.once("drain",function(){c("pre-pause writing complete"),--n||r()}))}else r()},d.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},d.prototype.onData=function(e){var t=this;c("polling got data %s",e);i.decodePayload(e,this.socket.binaryType,function(e,r,n){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},d.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},d.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};i.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},d.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},function(e,t,r){(function(t){var n=r(84),o=Object.prototype.toString,i="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===o.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===o.call(File);e.exports=function e(r){if(!r||"object"!=typeof r)return!1;if(n(r)){for(var o=0,s=r.length;o<s;o++)if(e(r[o]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(r)||"function"==typeof ArrayBuffer&&r instanceof ArrayBuffer||i&&r instanceof Blob||a&&r instanceof File)return!0;if(r.toJSON&&"function"==typeof r.toJSON&&1===arguments.length)return e(r.toJSON(),!0);for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)&&e(r[c]))return!0;return!1}}).call(this,r(22).Buffer)},function(e,t,r){"use strict";var n,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,a={},s=0,c=0;function u(e){var t="";do{t=o[e%i]+t,e=Math.floor(e/i)}while(e>0);return t}function d(){var e=u(+new Date);return e!==n?(s=0,n=e):e+"."+u(s++)}for(;c<i;c++)a[o[c]]=c;d.encode=u,d.decode=function(e){var t=0;for(c=0;c<e.length;c++)t=t*i+a[e.charAt(c)];return t},e.exports=d},function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t,r){var n=r(21),o=r(10),i=r(94),a=r(37),s=r(38),c=r(14)("socket.io-client:socket"),u=r(15),d=r(33);e.exports=f;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=o.prototype.emit;function f(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}o(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",s(this,"onopen")),a(e,"packet",s(this,"onpacket")),a(e,"close",s(this,"onclose"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},f.prototype.send=function(){var e=i(arguments);return e.unshift("message"),this.emit.apply(this,e),this},f.prototype.emit=function(e){if(l.hasOwnProperty(e))return p.apply(this,arguments),this;var t=i(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:d(t))?n.BINARY_EVENT:n.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},f.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},f.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?u.encode(this.query):this.query;c("sending connect packet with query %s",e),this.packet({type:n.CONNECT,query:e})}else this.packet({type:n.CONNECT})},f.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},f.prototype.onpacket=function(e){var t=e.nsp===this.nsp,r=e.type===n.ERROR&&"/"===e.nsp;if(t||r)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},f.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},f.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var o=i(arguments);c("sending ack %j",o),t.packet({type:d(o)?n.BINARY_ACK:n.ACK,id:e,data:o})}}},f.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},f.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},f.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},f.prototype.compress=function(e){return this.flags.compress=e,this},f.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){e.exports=function(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}},function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},function(e,t,r){const n=r(40),o=r(70),i=document.querySelector("body"),a=new n.Room,s=o("/");let c,u,d,l,p=!1,f=0;function h(e=!0,t="audio"){const r=document.createElement("video");return r.id=`video${++f}_${e?"remote":"local"}`,r.class=e?"remote":"local",r.style="video"===t?e?"height: 720px;":"height: 120px;":"height: 0px;",r.style.position="relative",e||(r.muted=!0),r.oncanplay=(e=>(function(e){return e.play().catch(()=>{y||(m.push(e),(y=document.createElement("div")).style.position="fixed",y.style.backgroundColor="rgba(0,0,0,0.4)",y.style.top="0",y.style.right="0",y.style.bottom="0",y.style.left="0",y.style.color="#fff",y.style.textAlign="center",y.style.verticalAlign="middle",y.style.zIndex="999",y.style.padding="15px",y.style.fontFamily="sans-serif",y.innerText="Click to Play",document.body.appendChild(y),document.onclick=(()=>{for(document.onclick=void 0,y.remove(),y=void 0;m.length;)m.shift().play()}))}),!0})(r)&&console.log(r.id,"canplay",e)),r.onabort=(e=>console.log(r.id,"abort",e)),r.oncanplaythrough=(e=>console.log(r.id,"canplaythrough",e)),r.ondurationchange=(e=>console.log(r.id,"durationchange",e)),r.onemptied=(e=>console.log(r.id,"emptied",e)),r.onended=(e=>console.log(r.id,"ended",e)),r.onerror=(e=>console.log(r.id,"error",e)),r.onloadeddata=(e=>console.log(r.id,"loadeddata",e)),r.onloadedmetadata=(e=>console.log(r.id,"loadedmetadata",e)),r.onloadstart=(e=>console.log(r.id,"loadstart",e)),r.onpause=(e=>console.log(r.id,"pause",e)),r.onplay=(e=>console.log(r.id,"play",e)),r.onplaying=(e=>console.log(r.id,"playing",e)),r.onratechange=(e=>console.log(r.id,"ratechange",e)),r.onseeked=(e=>console.log(r.id,"seeked",e)),r.onseeking=(e=>console.log(r.id,"seeking",e)),r.onstalled=(e=>console.log(r.id,"stalled",e)),r.onsuspend=(e=>console.log(r.id,"suspend",e)),r.onvolumechange=(e=>console.log(r.id,"volumechange",e)),r.onwaiting=(e=>console.log(r.id,"waiting",e)),r}const m=[];let y;function v(e){console.log("handleConsumer",e);const t=e.element=h(!0,e.kind),r=new MediaStream;t.srcObject=r,e.receive(c).then(e=>{console.log("receiving a new remote MediaStreamTrack",e),r.addTrack(e)}),e.on("close",()=>{console.log("Consumer closed"),e.element&&function(e){const t=m.indexOf(e);return t>-1&&m.splice(t,1),y&&!m.length&&(document.onclick=void 0,y.remove(),y=void 0),!0}(e.element)&&e.element.remove()}),i.appendChild(t)}function g(e){console.log("handlePeer",e);for(const t of e.consumers)v(t);e.on("close",()=>{console.log("Peer closed")}),e.on("newconsumer",e=>{console.log("Got a new Consumer"),v(e)})}function b(){console.log("handlePublish"),l.disabled=!0,u=a.createTransport("send"),navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{ideal:1280},height:{ideal:720}}}).then(e=>{const t=h(!1,"video");t.srcObject=e;const r=e.getAudioTracks()[0],n=e.getVideoTracks()[0],o=a.createProducer(r),i=a.createProducer(n);o.send(u).then(()=>console.log("publishing audio...")),i.send(u).then(()=>console.log("publishing video...")),l.replaceWith(t),p=!0})}function _(){return i.innerHTML="",delete a.currentPeerName,a.leave()}function w(){a.currentPeerName=d,a.join(d).then(e=>{console.log("peers",e),c=a.createTransport("recv"),(l=document.createElement("button")).id="publish",l.innerText="Publish",l.onclick=b,i.insertBefore(document.createElement("br"),i.childNodes[0]),i.insertBefore(l,i.childNodes[0]);for(const t of e)g(t);p&&b()})}a.on("newpeer",e=>{console.log("room:newpeer",e),g(e)}),a.on("request",(e,t,r)=>{console.log("room:request",e),s.emit("request",e,({error:e,data:n})=>e?r(e):t(n))}),a.on("notify",e=>{console.log("room:notify",e),s.emit("notification",e)}),s.on("notification",e=>{console.log("socket:notification",e),a.receiveNotification(e)}),s.on("connect",()=>{console.log("socket connected")}),s.on("connect_error",e=>{console.error("socket connect error",e)}),s.on("peername",e=>{console.log("socket:peername",e),d=e,function(){let e=Promise.resolve(!0);a.currentPeerName&&(e=e.then(_)),e.then(w).catch(e=>console.error("JOIN error",e))}()})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setDeviceHandler=function(e,t){o.default.setHandler(e,t)},t.isDeviceSupported=function(){return o.default.isSupported()},t.getDeviceInfo=function(){return{flag:o.default.getFlag(),name:o.default.getName(),version:o.default.getVersion(),bowser:o.default.getBowser()}},t.checkCapabilitiesForRoom=function(e){return o.default.isSupported()?o.default.Handler.getNativeRtpCapabilities().then(function(t){var r=n.getExtendedRtpCapabilities(t,e);return{audio:n.canSend("audio",r),video:n.canSend("video",r)}}):Promise.reject(new Error("current browser/device not supported"))},Object.defineProperty(t,"Room",{enumerable:!0,get:function(){return i.default}}),t.internals=void 0;var n=c(r(3)),o=s(r(18)),i=s(r(61)),a=c(r(67));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}t.internals=a},function(e,t,r){var n;n=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||""}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||""}var o,a=r(/(ipod|iphone|ipad)/i).toLowerCase(),s=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\s*[0-6]\s*/i.test(t),u=!c&&/nexus\s*[0-9]+/i.test(t),d=/CrOS/.test(t),l=/silk/i.test(t),p=/sailfish/i.test(t),f=/tizen/i.test(t),h=/(web|hpw)(o|0)s/i.test(t),m=/windows phone/i.test(t),y=(/SamsungBrowser/i.test(t),!m&&/windows/i.test(t)),v=!a&&!l&&/macintosh/i.test(t),g=!s&&!p&&!f&&!h&&/linux/i.test(t),b=n(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),_=r(/version\/(\d+(\.\d+)?)/i),w=/tablet/i.test(t)&&!/tablet pc/i.test(t),P=!w&&/[^-]mobi/i.test(t),k=/xbox/i.test(t);/opera/i.test(t)?o={name:"Opera",opera:e,version:_||r(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?o={name:"Opera",opera:e,version:r(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||_}:/SamsungBrowser/i.test(t)?o={name:"Samsung Internet for Android",samsungBrowser:e,version:_||r(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(t)?o={name:"NAVER Whale browser",whale:e,version:r(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(t)?o={name:"MZ Browser",mzbrowser:e,version:r(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(t)?o={name:"Opera Coast",coast:e,version:_||r(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(t)?o={name:"Focus",focus:e,version:r(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(t)?o={name:"Yandex Browser",yandexbrowser:e,version:_||r(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?o={name:"UC Browser",ucbrowser:e,version:r(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?o={name:"Maxthon",maxthon:e,version:r(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?o={name:"Epiphany",epiphany:e,version:r(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?o={name:"Puffin",puffin:e,version:r(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?o={name:"Sleipnir",sleipnir:e,version:r(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?o={name:"K-Meleon",kMeleon:e,version:r(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(o={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},b?(o.msedge=e,o.version=b):(o.msie=e,o.version=r(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?o={name:"Internet Explorer",msie:e,version:r(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:d?o={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?o={name:"Microsoft Edge",msedge:e,version:b}:/vivaldi/i.test(t)?o={name:"Vivaldi",vivaldi:e,version:r(/vivaldi\/(\d+(\.\d+)?)/i)||_}:p?o={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:r(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?o={name:"SeaMonkey",seamonkey:e,version:r(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(o={name:"Firefox",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(o.firefoxos=e,o.osname="Firefox OS")):l?o={name:"Amazon Silk",silk:e,version:r(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?o={name:"PhantomJS",phantom:e,version:r(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?o={name:"SlimerJS",slimer:e,version:r(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?o={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:_||r(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:h?(o={name:"WebOS",osname:"WebOS",webos:e,version:_||r(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(o.touchpad=e)):/bada/i.test(t)?o={name:"Bada",osname:"Bada",bada:e,version:r(/dolfin\/(\d+(\.\d+)?)/i)}:f?o={name:"Tizen",osname:"Tizen",tizen:e,version:r(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||_}:/qupzilla/i.test(t)?o={name:"QupZilla",qupzilla:e,version:r(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||_}:/chromium/i.test(t)?o={name:"Chromium",chromium:e,version:r(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||_}:/chrome|crios|crmo/i.test(t)?o={name:"Chrome",chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:s?o={name:"Android",version:_}:/safari|applewebkit/i.test(t)?(o={name:"Safari",safari:e},_&&(o.version=_)):a?(o={name:"iphone"==a?"iPhone":"ipad"==a?"iPad":"iPod"},_&&(o.version=_)):o=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:r(/googlebot\/(\d+(\.\d+))/i)||_}:{name:r(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(o.name=o.name||"Blink",o.blink=e):(o.name=o.name||"Webkit",o.webkit=e),!o.version&&_&&(o.version=_)):!o.opera&&/gecko\//i.test(t)&&(o.name=o.name||"Gecko",o.gecko=e,o.version=o.version||r(/gecko\/(\d+(\.\d+)?)/i)),o.windowsphone||!s&&!o.silk?!o.windowsphone&&a?(o[a]=e,o.ios=e,o.osname="iOS"):v?(o.mac=e,o.osname="macOS"):k?(o.xbox=e,o.osname="Xbox"):y?(o.windows=e,o.osname="Windows"):g&&(o.linux=e,o.osname="Linux"):(o.android=e,o.osname="Android");var C="";o.windows?C=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(r(/Windows ((NT|XP)( \d\d?.\d)?)/i)):o.windowsphone?C=r(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):o.mac?C=(C=r(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):a?C=(C=r(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):s?C=r(/android[ \/-](\d+(\.\d+)*)/i):o.webos?C=r(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?C=r(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?C=r(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(C=r(/tizen[\/\s](\d+(\.\d+)*)/i)),C&&(o.osversion=C);var S=!o.windows&&C.split(".")[0];return w||u||"ipad"==a||s&&(3==S||S>=4&&!P)||o.silk?o.tablet=e:(P||"iphone"==a||"ipod"==a||s||c||o.blackberry||o.webos||o.bada)&&(o.mobile=e),o.msedge||o.msie&&o.version>=10||o.yandexbrowser&&o.version>=15||o.vivaldi&&o.version>=1||o.chrome&&o.version>=20||o.samsungBrowser&&o.version>=4||o.whale&&1===i([o.version,"1.0"])||o.mzbrowser&&1===i([o.version,"6.0"])||o.focus&&1===i([o.version,"1.0"])||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1||o.chromium&&o.version>=20?o.a=e:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6||o.chromium&&o.version<20?o.c=e:o.x=e,o}var r=t("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function o(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function i(e){for(var t=Math.max(n(e[0]),n(e[1])),r=o(e,function(e){var r=t-n(e);return o((e+=new Array(r+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function a(e,n,o){var a=r;"string"==typeof n&&(o=n,n=void 0),void 0===n&&(n=!1),o&&(a=t(o));var s=""+a.version;for(var c in e)if(e.hasOwnProperty(c)&&a[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return i([s,e[c]])<0}return n}return r.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=a,r.compareVersions=i,r.check=function(e,t,r){return!a(e,t,r)},r._detect=t,r.detect=t,r},e.exports?e.exports=n():r(42)("bowser",n)},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,r){(function(n){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(o=n))}),t.splice(o,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(44)(t);const{formatters:o}=e.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(13))},function(e,t,r){e.exports=function(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let r;function a(...e){if(!a.enabled)return;const t=a,o=Number(new Date),i=o-(r||o);t.diff=i,t.prev=r,t.curr=o,r=o,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return r;s++;const i=n.formatters[o];if("function"==typeof i){const n=e[s];r=i.call(t,n),e.splice(s,1),s--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return a.namespace=e,a.enabled=n.enabled(e),a.useColors=n.useColors(),a.color=t(e),a.destroy=o,a.extend=i,"function"==typeof n.init&&n.init(a),n.instances.push(a),a}function o(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function i(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){const e=[...n.names.map(a),...n.skips.map(a).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=r(45),Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}},function(e,t){var r=1e3,n=60*r,o=60*n,i=24*o,a=7*i,s=365.25*i;function c(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}e.exports=function(e,t){t=t||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var c=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*s;case"weeks":case"week":case"w":return c*a;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*o;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return c(e,t,i,"day");if(t>=o)return c(e,t,o,"hour");if(t>=n)return c(e,t,n,"minute");if(t>=r)return c(e,t,r,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=n)return Math.round(e/n)+"m";if(t>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(6)),d=p(r(7));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Chrome70"),P=function(e){function t(e,r,n){var o;return h(this,t),(o=v(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return b(t,i.default),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),k=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._trackIds=new Set,n}return b(t,P),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,i=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,i.id),this._trackIds.has(i.id)?Promise.reject(new Error("track already added")):(this._trackIds.add(i.id),Promise.resolve().then(function(){if(t=o._pc.getTransceivers().find(function(e){return e.receiver.track.kind===i.kind&&"inactive"===e.direction}))return w.debug("addProducer() | reusing an inactive transceiver"),t.direction="sendonly",t.sender.replaceTrack(i);t=o._pc.addTransceiver(i,{direction:"sendonly"})}).then(function(){return o._pc.createOffer()}).then(function(r){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var a=n.default.parse(r.sdp);u.addPlanBSimulcast(a,i,{mid:t.mid}),r={type:"offer",sdp:n.default.write(a)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",r),o._pc.setLocalDescription(r)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var n=a.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,r,i,{mid:t.mid,planBSimulcast:!0}),n}).catch(function(e){try{t.direction="inactive"}catch(e){}throw o._trackIds.delete(i.id),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()}).then(function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})):Promise.reject(new Error("track not found"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)})}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),C=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return b(t,P),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getTransceivers().find(function(e){return e.mid===o.mid});if(!e)throw new Error("remote track not found");return e.receiver.track})}},{key:"removeConsumer",value:function(e){var t=this;w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),S=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome70"}}]),e}();t.default=S},function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=n(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(25),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(a))return o(c,n,a)}}),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},function(e,t,r){var n=r(25),o=/%[sdv%]/g,i=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return function(e){var t=1,r=arguments,n=r.length;return e.replace(o,function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})}.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||a,o=t.innerOrder||s,c=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(i(t,r,e))})})}),e.media.forEach(function(e){c.push(i("m",n.m[0],e)),o.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(i(t,r,e))})})})}),c.join("\r\n")+"\r\n"}},function(e,t){!function(t){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}e.exports=n,e.exports.generator=function(e){return e=r(e),function(t,r,o){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=o?o:e.integer,n(e)}},e.exports.defaults=r}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(8)),d=p(r(9));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Chrome69"),P=function(e){function t(e,r,n){var o;return h(this,t),(o=v(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return b(t,i.default),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),k=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return b(t,P),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,i=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,i.id),this._stream.getTrackById(i.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){return o._stream.addTrack(i),t=o._pc.addTrack(i,o._stream),o._pc.createOffer()}).then(function(t){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var r=n.default.parse(t.sdp);u.addSimulcastForTrack(r,i),t={type:"offer",sdp:n.default.write(r)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),o._pc.setLocalDescription(t)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var t=a.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,i),t}).catch(function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(i),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),C=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,P),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),S=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome69"}}]),e}();t.default=S},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(8)),d=p(r(9));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Chrome67"),P=function(e){function t(e,r,n){var o;return h(this,t),(o=v(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return b(t,i.default),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),k=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return b(t,P),y(t,[{key:"addProducer",value:function(e){var t,r=this,o=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){return r._stream.addTrack(o),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(t){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var i=n.default.parse(t.sdp);u.addSimulcastForTrack(i,o),t={type:"offer",sdp:n.default.write(i)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),r._pc.setLocalDescription(t)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){t=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(t)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var n=a.clone(r._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,t,o),n}).catch(function(e){throw r._stream.removeTrack(o),r._pc.addStream(r._stream),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),C=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,P),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),S=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome67"}}]),e}();t.default=S},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(8)),d=p(r(9));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Chrome55"),P=function(e){function t(e,r,n){var o;return h(this,t),(o=v(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return b(t,i.default),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),k=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return b(t,P),y(t,[{key:"addProducer",value:function(e){var t,r=this,o=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){return r._stream.addTrack(o),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(t){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var i=n.default.parse(t.sdp);u.addSimulcastForTrack(i,o),t={type:"offer",sdp:n.default.write(i)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),r._pc.setLocalDescription(t)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){t=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(t)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var n=a.clone(r._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,t,o),n}).catch(function(e){throw r._stream.removeTrack(o),r._pc.addStream(r._stream),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var o,i=e.track;return Promise.resolve().then(function(){return r._stream.removeTrack(i),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(o){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var i=n.default.parse(o.sdp);u.addSimulcastForTrack(i,t),o={type:"offer",sdp:n.default.write(i)}}return w.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",o),r._pc.setLocalDescription(o)}).then(function(){o=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(o)};return w.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var n=a.clone(r._rtpParametersByKind[e.kind]);u.fillRtpParametersForTrack(n,o,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._stream.removeTrack(t),r._stream.addTrack(i),r._pc.addStream(r._stream),e})}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),C=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,P),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),S=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome55"}}]),e}();t.default=S},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(6)),d=p(r(7));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Safari12"),P=function(e){function t(e,r,n){var o;return h(this,t),(o=v(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return b(t,i.default),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),k=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._trackIds=new Set,n}return b(t,P),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,i=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,i.id),this._trackIds.has(i.id)?Promise.reject(new Error("track already added")):(this._trackIds.add(i.id),Promise.resolve().then(function(){if(t=o._pc.getTransceivers().find(function(e){return e.receiver.track.kind===i.kind&&"inactive"===e.direction}))return w.debug("addProducer() | reusing an inactive transceiver"),t.direction="sendonly",t.sender.replaceTrack(i);t=o._pc.addTransceiver(i,{direction:"sendonly"})}).then(function(){return o._pc.createOffer()}).then(function(r){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var a=n.default.parse(r.sdp);u.addPlanBSimulcast(a,i,{mid:t.mid}),r={type:"offer",sdp:n.default.write(a)}}return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",r),o._pc.setLocalDescription(r)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var n=a.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,r,i,{mid:t.mid,planBSimulcast:!0}),n}).catch(function(e){try{t.direction="inactive"}catch(e){}throw o._trackIds.delete(i.id),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()}).then(function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})):Promise.reject(new Error("track not found"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)})}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),C=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return b(t,P),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getTransceivers().find(function(e){return e.mid===o.mid});if(!e)throw new Error("remote track not found");return e.receiver.track})}},{key:"removeConsumer",value:function(e){var t=this;w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),S=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Safari12"}}]),e}();t.default=S},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(8)),d=p(r(9));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("Safari11"),P=function(e){function t(e,r,n){var o;return h(this,t),(o=v(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return b(t,i.default),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),k=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return b(t,P),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,i=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,i.id),this._stream.getTrackById(i.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){return o._stream.addTrack(i),t=o._pc.addTrack(i,o._stream),o._pc.createOffer()}).then(function(e){return w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var t=a.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,i),t}).catch(function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(i),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),C=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,P),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),S=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Safari11"}}]),e}();t.default=S},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(6)),d=p(r(7));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),e}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Firefox65"),k=function(e){function t(e,r,n){var o;return m(this,t),(o=g(this,b(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return _(t,i.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){P.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),C=function(e){function t(e,r){var n;return m(this,t),(n=g(this,b(t).call(this,"send",e,r)))._transportReady=!1,n._trackIds=new Set,n._nextRid=1,n}return _(t,k),v(t,[{key:"addProducer",value:function(e){var t,r,o=this,i=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,i.id),this._trackIds.has(i.id)?Promise.reject(new Error("track already added")):(this._trackIds.add(i.id),Promise.resolve().then(function(){if(t=o._pc.getTransceivers().find(function(e){return e.receiver.track.kind===i.kind&&"inactive"===e.direction}))return P.debug("addProducer() | reusing an inactive transceiver"),t.direction="sendonly",t.sender.replaceTrack(i);t=o._pc.addTransceiver(i,{direction:"sendonly"})}).then(function(){var r=t.sender,n=[];e.simulcast&&(P.debug("addProducer() | enabling simulcast"),e.simulcast.high&&n.push({rid:"high".concat(o._nextRid),active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&n.push({rid:"medium".concat(o._nextRid),active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&n.push({rid:"low".concat(o._nextRid),active:!0,priority:"high",maxBitrate:e.simulcast.low}),o._nextRid++);var i=r.getParameters();return r.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){f(e,t,r[t])})}return e}({},i,{encodings:n}))}).then(function(){return o._pc.createOffer()}).then(function(e){return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var n=a.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,r,i,{mid:t.mid}),n}).catch(function(e){try{t.direction="inactive"}catch(e){}throw o._trackIds.delete(i.id),e}))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("local track not found");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})):Promise.reject(new Error("track not found"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;return m(this,t),(n=g(this,b(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return _(t,k),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getTransceivers().find(function(e){return e.mid===o.mid});if(!e)throw new Error("remote track not found");return e.receiver.track})}},{key:"removeConsumer",value:function(e){var t=this;P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),R=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new C(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),o=r.getVideoTracks()[0];return e.addTrack(o,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}var i=n.default.parse(r.sdp);return c.extractRtpCapabilities(i)}).catch(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"tag",get:function(){return"Firefox65"}}]),e}();t.default=R},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(6)),d=p(r(7));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),e}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Firefox59"),k=function(e){function t(e,r,n){var o;return m(this,t),(o=g(this,b(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return _(t,i.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){P.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),C=function(e){function t(e,r){var n;return m(this,t),(n=g(this,b(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return _(t,k),v(t,[{key:"addProducer",value:function(e){var t,r,o=this,i=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,i.id),this._stream.getTrackById(i.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){o._stream.addTrack(i),t=o._pc.addTrack(i,o._stream)}).then(function(){var r=[];e.simulcast&&(P.debug("addProducer() | enabling simulcast"),e.simulcast.high&&r.push({rid:"high".concat(o._nextRid),active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium".concat(o._nextRid),active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low".concat(o._nextRid),active:!0,priority:"high",maxBitrate:e.simulcast.low}),o._nextRid++);var n=t.getParameters();return t.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){f(e,t,r[t])})}return e}({},n,{encodings:r}))}).then(function(){return o._pc.createOffer()}).then(function(e){return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var t=a.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,i),t}).catch(function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(i),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;return m(this,t),(n=g(this,b(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return _(t,k),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getTransceivers().find(function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===o.mid)});if(!e)throw new Error("remote track not found");return e.receiver.track})}},{key:"removeConsumer",value:function(e){var t=this;P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),R=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new C(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),o=r.getVideoTracks()[0];return e.addTrack(o,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}var i=n.default.parse(r.sdp);return c.extractRtpCapabilities(i)}).catch(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"tag",get:function(){return"Firefox59"}}]),e}();t.default=R},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(6)),d=p(r(7));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),e}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Firefox50"),k=function(e){function t(e,r,n){var o;return m(this,t),(o=g(this,b(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return _(t,i.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){P.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),C=function(e){function t(e,r){var n;return m(this,t),(n=g(this,b(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return _(t,k),v(t,[{key:"addProducer",value:function(e){var t,r,o=this,i=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,i.id),this._stream.getTrackById(i.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){o._stream.addTrack(i),t=o._pc.addTrack(i,o._stream)}).then(function(){var r=[];e.simulcast&&(P.debug("addProducer() | enabling simulcast"),e.simulcast.high&&r.push({rid:"high".concat(o._nextRid),active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium".concat(o._nextRid),active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low".concat(o._nextRid),active:!0,priority:"high",maxBitrate:e.simulcast.low}),o._nextRid++);var n=t.getParameters();return t.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){f(e,t,r[t])})}return e}({},n,{encodings:r}))}).then(function(){return o._pc.createOffer()}).then(function(e){return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var t=a.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,i),t}).catch(function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(i),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender not found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;m(this,t),(n=g(this,b(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map;return n._consumerInfos.set(555,{mid:"fake-dc",kind:"application",closed:!1,cname:null}),n}return _(t,k),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),R=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new C(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),o=r.getVideoTracks()[0];return e.addTrack(o,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}var i=n.default.parse(r.sdp);return c.extractRtpCapabilities(i)}).catch(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"tag",get:function(){return"Firefox50"}}]),e}();t.default=R},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(r(0)),o=u(r(2)),i=c(r(1)),a=c(r(3)),s=c(r(59));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y="CNAME-EDGE-".concat(i.randomNumber()),v=new n.default("Edge11"),g=function(e){function t(e,r,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=l(this,p(t).call(this,v)),v.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),o._rtpParametersByKind={audio:a.getSendingRtpParameters("audio",r),video:a.getSendingRtpParameters("video",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new Map,o._rtpReceivers=new Map,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,o.default),h(t,null,[{key:"getNativeRtpCapabilities",value:function(){return v.debug("getNativeRtpCapabilities()"),Promise.resolve(s.getCapabilities())}},{key:"tag",get:function(){return"Edge11"}}]),h(t,[{key:"close",value:function(){v.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var n,o=this._rtpSenders.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var i=n.value;try{i.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._rtpReceivers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value;try{l.stop()}catch(e){}}}catch(e){s=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw c}}}},{key:"remoteClosed",value:function(){v.debug("remoteClosed()"),this._transportReady=!1}},{key:"addProducer",value:function(e){var t=this,r=e.track;return v.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?Promise.reject(new Error("Producer already added")):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){v.debug("addProducer() | calling new RTCRtpSender()");var n=new RTCRtpSender(r,t._dtlsTransport),o=i.clone(t._rtpParametersByKind[e.kind]),a={ssrc:i.randomNumber()};o.codecs.some(function(e){return"rtx"===e.name})&&(a.rtx={ssrc:i.randomNumber()}),o.encodings.push(a),o.rtcp={cname:y,reducedSize:!0,mux:!0};var c=s.mangleRtpParameters(o);return v.debug("addProducer() | calling rtpSender.send() [params:%o]",c),n.send(c),t._rtpSenders.set(e.id,n),o})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return v.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error("RTCRtpSender not found");t._rtpSenders.delete(e.id);try{v.debug("removeProducer() | calling rtpSender.stop()"),r.stop()}catch(e){v.warn("rtpSender.stop() failed:%o",e)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;return v.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error("RTCRtpSender not found");n.setTrack(t)})}},{key:"addConsumer",value:function(e){var t=this;return v.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._rtpReceivers.has(e.id)?Promise.reject(new Error("Consumer already added")):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){v.debug("addConsumer() | calling new RTCRtpReceiver()");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener("error",function(e){v.error('iceGatherer "error" event [event:%o]',e)});var n=s.mangleRtpParameters(e.rtpParameters);return n.headerExtensions=n.headerExtensions.filter(function(e){return"urn:ietf:params:rtp-hdrext:sdes:mid"!==e.uri}),v.debug("addConsumer() | calling rtpReceiver.receive() [params:%o]",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track})}},{key:"removeConsumer",value:function(e){var t=this;return v.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),Promise.resolve().then(function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error("RTCRtpReceiver not found");t._rtpReceivers.delete(e.id);try{v.debug("removeConsumer() | calling rtpReceiver.stop()"),r.stop()}catch(e){v.warn("rtpReceiver.stop() failed:%o",e)}})}},{key:"restartIce",value:function(e){var t=this;v.debug("restartIce()"),Promise.resolve().then(function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;v.debug("restartIce() | calling iceTransport.start()"),t._iceTransport.start(t._iceGatherer,e,"controlling");var n=!0,o=!1,i=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;t._iceTransport.addRemoteCandidate(c)}}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}t._iceTransport.addRemoteCandidate({})})}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:e.iceTransportPolicy});t.addEventListener("error",function(e){v.error('iceGatherer "error" event [event:%o]',e)});try{t.gather()}catch(e){v.debug("iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("icestatechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("candidatepairchange",function(e){v.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener("statechange",function(){v.debug('dtlsTransport "statechange" event [state:%s]',t.state)}),t.addEventListener("dtlsstatechange",function(){v.debug('dtlsTransport "dtlsstatechange" event [state:%s]',t.state),"closed"===t.state&&e.emit("@connectionstatechange","closed")}),t.addEventListener("error",function(e){v.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=t}},{key:"_setupTransport",value:function(){var e=this;return v.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role="server",t.dtlsParameters=r,e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._transportRemoteParameters=t;var r=t.iceParameters,n=t.iceCandidates,o=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,"controlling");var i=!0,a=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var d=c.value;e._iceTransport.addRemoteCandidate(d)}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}e._iceTransport.addRemoteCandidate({}),o.fingerprints=o.fingerprints.filter(function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm}),e._dtlsTransport.start(o),e._transportReady=!0})}}]),t}();t.default=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=n.clone(e),r=!0,o=!1,i=void 0;try{for(var a,s=t.codecs[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;if(c.channels=c.numChannels,delete c.numChannels,"audio"!==c.kind?delete c.channels:c.channels||(c.channels=1),c.mimeType="".concat(c.kind,"/").concat(c.name),c.parameters){var u=c.parameters;u.apt&&(u.apt=Number(u.apt)),u["packetization-mode"]&&(u["packetization-mode"]=Number(u["packetization-mode"]))}var d=!0,l=!1,p=void 0;try{for(var f,h=(c.rtcpFeedback||[])[Symbol.iterator]();!(d=(f=h.next()).done);d=!0){var m=f.value;m.parameter||delete m.parameter}}catch(e){l=!0,p=e}finally{try{d||null==h.return||h.return()}finally{if(l)throw p}}}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return t},t.mangleRtpParameters=function(e){var t=n.clone(e),r=!0,o=!1,i=void 0;try{for(var a,s=t.codecs[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;c.channels&&(c.numChannels=c.channels,delete c.channels),delete c.mimeType}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return t};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(1))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(4)),o=p(r(0)),i=p(r(2)),a=l(r(1)),s=l(r(3)),c=l(r(5)),u=l(r(8)),d=p(r(9));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=new o.default("ReactNative"),P=function(e){function t(e,r,n){var o;return h(this,t),(o=v(this,g(t).call(this,w)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return b(t,i.default),y(t,[{key:"close",value:function(){w.debug("close()");try{this._pc.close()}catch(e){}}},{key:"remoteClosed",value:function(){w.debug("remoteClosed()"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(),k=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"send",e,r)))._transportReady=!1,n._tracks=new Set,n}return b(t,P),y(t,[{key:"addProducer",value:function(e){var t,r,o=this,i=e.track;return w.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,i.id),this._tracks.has(i)?Promise.reject(new Error("track already added")):i.streamReactTag?Promise.resolve().then(function(){return o._tracks.add(i),(t=new MediaStream(i.streamReactTag)).addTrack(i),o._pc.addStream(t),o._pc.createOffer()}).then(function(t){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var r=n.default.parse(t.sdp);u.addSimulcastForTrack(r,i),t={type:"offer",sdp:n.default.write(r)}}w.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t);var a=new RTCSessionDescription(t);return o._pc.setLocalDescription(a)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};w.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return o._pc.setRemoteDescription(t)}).then(function(){var t=a.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,i),t}).catch(function(e){throw o._tracks.delete(i),t.removeTrack(i),o._pc.removeStream(t),e}):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return w.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),r.streamReactTag?Promise.resolve().then(function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.removeStream(e),t._pc.createOffer()}).then(function(e){return w.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._tracks.size)throw e;w.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};w.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r);var o=new RTCSessionDescription(r);return t._pc.setRemoteDescription(o)}}):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;if(w.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),!t.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var o,i,s=e.track;return Promise.resolve().then(function(){return r._tracks.add(t),r._tracks.delete(s),(o=new MediaStream(t.streamReactTag)).addTrack(t),o.removeTrack(s),r._pc.addStream(o),r._pc.createOffer()}).then(function(o){if(e.simulcast){w.debug("addProducer() | enabling simulcast");var i=n.default.parse(o.sdp);u.addSimulcastForTrack(i,t),o={type:"offer",sdp:n.default.write(i)}}w.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",o);var a=new RTCSessionDescription(o);return r._pc.setLocalDescription(a)}).then(function(){i=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(i)};w.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return r._pc.setRemoteDescription(t)}).then(function(){var n=a.clone(r._rtpParametersByKind[e.kind]);u.fillRtpParametersForTrack(n,i,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._tracks.delete(t),o.removeTrack(t),r._pc.addStream(o),e})}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};w.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r);var o=new RTCSessionDescription(r);return t._pc.setRemoteDescription(o)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),i=c.extractDtlsParameters(o);return i.role="server",t.dtlsParameters=i,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),C=function(e){function t(e,r){var n;return h(this,t),(n=v(this,g(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return b(t,P),y(t,[{key:"addConsumer",value:function(e){var t=this;if(w.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};w.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}),r=e.getTrackById(o.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error("remote track not found");return r})}},{key:"removeConsumer",value:function(e){var t=this;return w.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};w.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return w.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};w.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return w.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return w.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){w.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),S=function(){function e(t,r,n){var o;switch(h(this,e),w.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new C(o,n)}}return y(e,null,[{key:"getNativeRtpCapabilities",value:function(){w.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"ReactNative"}}]),e}();t.default=S},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=p(r(0)),o=p(r(2)),i=r(12),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(3)),s=p(r(18)),c=p(r(62)),u=p(r(64)),d=p(r(65)),l=p(r(66));function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=new n.default("Room"),b={new:"new",joining:"joining",joined:"joined",closed:"closed"},_=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=m(this,y(t).call(this,g)),g.debug("constructor() [options:%o]",e),!s.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||3e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[],iceTransportPolicy:e.iceTransportPolicy||"all",spy:Boolean(e.spy)},r._state=b.new,r._peerName=null,r._transports=new Map,r._producers=new Map,r._peers=new Map,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}var r,n,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,o.default),r=t,(n=[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,t){var r,n=this;return g.debug('join() [peerName:"%s"]',e),"string"!=typeof e?Promise.reject(new TypeError("invalid peerName")):this._state!==b.new&&this._state!==b.closed?Promise.reject(new i.InvalidStateError('invalid state "'.concat(this._state,'"'))):(this._peerName=e,this._state=b.joining,Promise.resolve().then(function(){return n._settings.roomSettings?void(r=n._settings.roomSettings):n._sendRequest("queryRoom",{target:"room"}).then(function(e){r=e,g.debug("join() | got Room settings:%o",r)})}).then(function(){return s.default.Handler.getNativeRtpCapabilities()}).then(function(e){g.debug("join() | native RTP capabilities:%o",e),n._extendedRtpCapabilities=a.getExtendedRtpCapabilities(e,r.rtpCapabilities),g.debug("join() | extended RTP capabilities:%o",n._extendedRtpCapabilities);var o=a.getUnsupportedCodecs(r.rtpCapabilities,r.mandatoryCodecPayloadTypes,n._extendedRtpCapabilities);if(o.length>0)throw g.error("%s mandatory room codecs not supported:%o",o.length,o),new i.UnsupportedError("mandatory room codecs not supported",o);n._canSendByKind.audio=a.canSend("audio",n._extendedRtpCapabilities),n._canSendByKind.video=a.canSend("video",n._extendedRtpCapabilities);var s=a.getRtpCapabilities(n._extendedRtpCapabilities);g.debug("join() | effective local RTP capabilities for receiving:%o",s);var c={target:"room",peerName:n._peerName,rtpCapabilities:s,spy:n._settings.spy,appData:t};return n._sendRequest("join",c).then(function(e){return e.peers})}).then(function(e){var t=!0,r=!1,o=void 0;try{for(var i,a=(e||[])[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;try{n._handlePeerData(s)}catch(e){g.error("join() | error handling Peer:%o",e)}}}catch(e){r=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw o}}return n._state=b.joined,g.debug("join() | joined the Room"),n.peers}).catch(function(e){throw n._state=b.new,e}))}},{key:"leave",value:function(e){if(g.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=b.closed,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._transports.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.close()}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){u.value.close()}}catch(e){s=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var h,m=this._peers.values()[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){h.value.close()}}catch(e){p=!0,f=e}finally{try{l||null==m.return||m.return()}finally{if(p)throw f}}}}},{key:"remoteClose",value:function(e){if(g.debug("remoteClose()"),!this.closed){this._state=b.closed,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._transports.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.remoteClose(null,{destroy:!0})}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){u.value.remoteClose()}}catch(e){s=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var h,m=this._peers.values()[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){h.value.remoteClose()}}catch(e){p=!0,f=e}finally{try{l||null==m.return||m.return()}finally{if(p)throw f}}}}},{key:"canSend",value:function(e){if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'.concat(e,'"'));return!(!this.joined||this._settings.spy)&&this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var r=this;if(g.debug("createTransport() [direction:%s]",e),!this.joined)throw new i.InvalidStateError('invalid state "'.concat(this._state,'"'));if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'.concat(e,'"'));if("send"===e&&this._settings.spy)throw new TypeError("a spy peer cannot send media to the room");var n=new c.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on("@request",function(e,t,n,o){r._sendRequest(e,t).then(n).catch(o)}),n.on("@notify",function(e,t){r._sendNotification(e,t)}),n.on("@close",function(){r._transports.delete(n.id)}),n}},{key:"createProducer",value:function(e,t,r){var n=this;if(g.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new i.InvalidStateError('invalid state "'.concat(this._state,'"'));if(this._settings.spy)throw new Error("a spy peer cannot send media to the room");if(!e)throw new TypeError("no track given");if(!this._canSendByKind[e.kind])throw new Error("cannot send ".concat(e.kind));if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var o=new u.default(e,t,r);return this._producers.set(o.id,o),o.on("@close",function(){n._producers.delete(o.id)}),o}},{key:"restartIce",value:function(){if(this.joined){var e=!0,t=!1,r=void 0;try{for(var n,o=this._transports.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.restartIce()}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}else g.warn('restartIce() | invalid state "'.concat(this._state,'"'))}},{key:"receiveNotification",value:function(e){var t=this;if(this.closed)return Promise.reject(new i.InvalidStateError("Room closed"));if("object"!==f(e))return Promise.reject(new TypeError("wrong notification Object"));if(!0!==e.notification)return Promise.reject(new TypeError("not a notification"));if("string"!=typeof e.method)return Promise.reject(new TypeError("wrong/missing notification method"));var r=e.method;return g.debug("receiveNotification() [method:%s, notification:%o]",r,e),Promise.resolve().then(function(){switch(r){case"closed":var n=e.appData;t.remoteClose(n);break;case"transportClosed":var o=e.id,i=e.appData,a=t._transports.get(o);if(!a)throw new Error('Transport not found [id:"'.concat(o,'"]'));a.remoteClose(i,{destroy:!1});break;case"transportStats":var s=e.id,c=e.stats,u=t._transports.get(s);if(!u)throw new Error("Transport not found [id:".concat(s,"]"));u.remoteStats(c);break;case"newPeer":var d=e.name;if(t._peers.has(d))throw new Error('Peer already exists [name:"'.concat(d,'"]'));var l=e;t._handlePeerData(l);break;case"peerClosed":var p=e.name,f=e.appData,h=t._peers.get(p);if(!h)throw new Error('no Peer found [name:"'.concat(p,'"]'));h.remoteClose(f);break;case"producerPaused":var m=e.id,y=e.appData,v=t._producers.get(m);if(!v)throw new Error("Producer not found [id:".concat(m,"]"));v.remotePause(y);break;case"producerResumed":var g=e.id,b=e.appData,_=t._producers.get(g);if(!_)throw new Error("Producer not found [id:".concat(g,"]"));_.remoteResume(b);break;case"producerClosed":var w=e.id,P=e.appData,k=t._producers.get(w);if(!k)throw new Error("Producer not found [id:".concat(w,"]"));k.remoteClose(P);break;case"producerStats":var C=e.id,S=e.stats,R=t._producers.get(C);if(!R)throw new Error("Producer not found [id:".concat(C,"]"));R.remoteStats(S);break;case"newConsumer":var T=e.peerName,O=t._peers.get(T);if(!O)throw new Error('no Peer found [name:"'.concat(T,'"]'));var E=e;t._handleConsumerData(E,O);break;case"consumerClosed":var x=e.id,A=e.peerName,D=e.appData,j=t._peers.get(A);if(!j)throw new Error('no Peer found [name:"'.concat(A,'"]'));var F=j.getConsumerById(x);if(!F)throw new Error("Consumer not found [id:".concat(x,"]"));F.remoteClose(D);break;case"consumerPaused":var I=e.id,B=e.peerName,L=e.appData,M=t._peers.get(B);if(!M)throw new Error('no Peer found [name:"'.concat(B,'"]'));var U=M.getConsumerById(I);if(!U)throw new Error("Consumer not found [id:".concat(I,"]"));U.remotePause(L);break;case"consumerResumed":var N=e.id,q=e.peerName,z=e.appData,G=t._peers.get(q);if(!G)throw new Error('no Peer found [name:"'.concat(q,'"]'));var Y=G.getConsumerById(N);if(!Y)throw new Error("Consumer not found [id:".concat(N,"]"));Y.remoteResume(z);break;case"consumerPreferredProfileSet":var K=e.id,V=e.peerName,H=e.profile,W=t._peers.get(V);if(!W)throw new Error('no Peer found [name:"'.concat(V,'"]'));var X=W.getConsumerById(K);if(!X)throw new Error("Consumer not found [id:".concat(K,"]"));X.remoteSetPreferredProfile(H);break;case"consumerEffectiveProfileChanged":var J=e.id,Z=e.peerName,Q=e.profile,$=t._peers.get(Z);if(!$)throw new Error('no Peer found [name:"'.concat(Z,'"]'));var ee=$.getConsumerById(J);if(!ee)throw new Error("Consumer not found [id:".concat(J,"]"));ee.remoteEffectiveProfileChanged(Q);break;case"consumerStats":var te=e.id,re=e.peerName,ne=e.stats,oe=t._peers.get(re);if(!oe)throw new Error('no Peer found [name:"'.concat(re,'"]'));var ie=oe.getConsumerById(te);if(!ie)throw new Error("Consumer not found [id:".concat(te,"]"));ie.remoteStats(ne);break;default:throw new Error('unknown notification method "'.concat(r,'"'))}}).catch(function(t){g.error("receiveNotification() failed [notification:%o]: %s",e,t)})}},{key:"_sendRequest",value:function(e,t){var r=this,n=Object.assign({method:e,target:"peer"},t);return this.closed?(g.error("_sendRequest() | Room closed [method:%s, request:%o]",e,n),Promise.reject(new i.InvalidStateError("Room closed"))):(g.debug("_sendRequest() [method:%s, request:%o]",e,n),new Promise(function(t,o){var a=!1,s=setTimeout(function(){g.error("request failed [method:%s]: timeout",e),a=!0,o(new i.TimeoutError("timeout"))},r._settings.requestTimeout);r.safeEmit("request",n,function(n){if(!a){if(a=!0,clearTimeout(s),r.closed)return g.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));g.debug("request succeeded [method:%s, response:%o]",e,n),t(n)}},function(t){if(!a){if(a=!0,clearTimeout(s),r.closed)return g.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));t instanceof Error||(t=new Error(String(t))),g.error("request failed [method:%s]:%o",e,t),o(t)}})}))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=Object.assign({method:e,target:"peer",notification:!0},t);g.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,i=new d.default(r,o);this._peers.set(i.name,i),i.on("@close",function(){t._peers.delete(i.name)});var a=!0,s=!1,c=void 0;try{for(var u,l=n[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var p=u.value;try{this._handleConsumerData(p,i)}catch(e){g.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){s=!0,c=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}this.joined&&this.safeEmit("newpeer",i)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,i=e.paused,s=e.appData,c=new l.default(r,n,o,t,s);a.canReceive(c.rtpParameters,this._extendedRtpCapabilities)&&c.setSupported(!0),i&&c.remotePause(),t.addConsumer(c)}},{key:"joined",get:function(){return this._state===b.joined}},{key:"closed",get:function(){return this._state===b.closed}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return Array.from(this._transports.values())}},{key:"producers",get:function(){return Array.from(this._producers.values())}},{key:"peers",get:function(){return Array.from(this._peers.values())}}])&&h(r.prototype,n),p&&h(r,p),t}();t.default=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(r(0)),o=u(r(2)),i=r(12),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(1)),s=u(r(18)),c=u(r(63));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m=new n.default("Transport"),y=function(e){function t(e,r,n,o){var i,u,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u=this,i=!(l=p(t).call(this,m))||"object"!==d(l)&&"function"!=typeof l?h(u):l,m.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),i._id=a.randomNumber(),i._closed=!1,i._direction=e,i._settings=n,i._appData=o,i._statsEnabled=!1,i._commandQueue=new c.default,i._handler=new s.default.Handler(e,r,n),i._connectionState="new",i._commandQueue.on("exec",i._execCommand.bind(h(h(i)))),i._handleHandler(),i}var r,n,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,o.default),r=t,(n=[{key:"close",value:function(e){m.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e,t){var r=t.destroy;m.debug("remoteClose() [destroy:%s]",r),this._closed||(r?(this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy()):this._handler.remoteClosed())}},{key:"_destroy",value:function(){this._commandQueue.close(),this._handler.close()}},{key:"restartIce",value:function(){var e=this;m.debug("restartIce()"),this._closed||"new"!==this._connectionState&&Promise.resolve().then(function(){var t={id:e._id};return e.safeEmitAsPromise("@request","restartTransport",t)}).then(function(t){var r=t.iceParameters;return e._commandQueue.push("restartIce",{remoteIceParameters:r})}).catch(function(e){m.error("restartIce() | failed: %o",e)})}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;m.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){m.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@connectionstatechange",function(t){e._connectionState!==t&&(m.debug("Transport connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}),t.on("@needcreatetransport",function(t,r,n){var o={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(t.dtlsParameters?o.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(o.plainRtpParameters=t.plainRtpParameters)),e.safeEmit("@request","createTransport",o,r,n)}),t.on("@needupdatetransport",function(t){var r={id:e._id};t&&(t.dtlsParameters?r.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(r.plainRtpParameters=t.plainRtpParameters)),e.safeEmit("@notify","updateTransport",r)}),t.on("@needupdateproducer",function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit("@notify","updateProducer",n)})}},{key:"addProducer",value:function(e){return m.debug("addProducer() [producer:%o]",e),this._closed?Promise.reject(new i.InvalidStateError("Transport closed")):"send"!==this._direction?Promise.reject(new Error("not a sending Transport")):this._commandQueue.push("addProducer",{producer:e})}},{key:"removeProducer",value:function(e,t,r){m.debug("removeProducer() [producer:%o]",e),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch(function(){}),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){m.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){m.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return m.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){m.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){m.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return m.debug("addConsumer() [consumer:%o]",e),this._closed?Promise.reject(new i.InvalidStateError("Transport closed")):"recv"!==this._direction?Promise.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){m.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch(function(){})}},{key:"pauseConsumer",value:function(e,t){m.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){m.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){m.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){m.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){m.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_execCommand",value:function(e,t){var r;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var o=e.producer;r=this._execRemoveProducer(o);break;case"replaceProducerTrack":var i=e.producer,a=e.track;r=this._execReplaceProducerTrack(i,a);break;case"addConsumer":var s=e.consumer;r=this._execAddConsumer(s);break;case"removeConsumer":var c=e.consumer;r=this._execRemoveConsumer(c);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=Promise.reject(new Error('unknown command method "'.concat(e.method,'"')))}}catch(e){r=Promise.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(e){var t,r=this;return m.debug("_execAddProducer()"),Promise.resolve().then(function(){return r._handler.addProducer(e)}).then(function(n){t=n;var o={id:e.id,kind:e.kind,transportId:r._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return r.safeEmitAsPromise("@request","createProducer",o)}).then(function(){e.setRtpParameters(t)})}},{key:"_execRemoveProducer",value:function(e){return m.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return m.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(e){var t,r=this;return m.debug("_execAddConsumer()"),Promise.resolve().then(function(){return r._handler.addConsumer(e)}).then(function(n){t=n;var o={id:e.id,transportId:r.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return r.safeEmitAsPromise("@request","enableConsumer",o)}).then(function(r){var n=r.paused,o=r.preferredProfile,i=r.effectiveProfile;return n&&e.remotePause(),o&&e.remoteSetPreferredProfile(o),i&&e.remoteEffectiveProfileChanged(i),t})}},{key:"_execRemoveConsumer",value:function(e){return m.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return m.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}},{key:"handler",get:function(){return this._handler}}])&&l(r.prototype,n),u&&l(r,u),t}();t.default=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=r(26),i=(n=r(0))&&n.__esModule?n:{default:n},a=r(12);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=new i.default("CommandQueue"),f=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=u(this,d(t).call(this))).setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,o.EventEmitter),r=t,(n=[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var r=this,n=Object.assign({method:e},t);return p.debug("push() [method:%s]",e),new Promise(function(e,t){var o=r._queue;n.resolve=e,n.reject=t,o.push(n),r._handlePendingCommands()})}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then(function(){e._busy=!1,t.shift(),e._handlePendingCommands()}))}}},{key:"_handleCommand",value:function(e){var t=this;if(p.debug("_handleCommand() [method:%s]",e.method),this._closed)return e.reject(new a.InvalidStateError("closed")),Promise.resolve();var r={promise:null};return this.emit("exec",e,r),Promise.resolve().then(function(){return r.promise}).then(function(r){p.debug("_handleCommand() | command succeeded [method:%s]",e.method),t._closed?e.reject(new a.InvalidStateError("closed")):e.resolve(r)}).catch(function(t){p.error("_handleCommand() | command failed [method:%s]: %o",e.method,t),e.reject(t)})}}])&&c(r.prototype,n),i&&c(r,i),t}();t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(r(0)),o=s(r(2)),i=r(12),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(1));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=1e3,h={low:1e5,medium:3e5,high:15e5},m=new n.default("Producer"),y=function(e){function t(e,r,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=d(this,l(t).call(this,m)))._id=a.randomNumber(),o._closed=!1,o._originalTrack=e;try{o._track=e.clone()}catch(t){o._track=e}return o._appData=n,o._simulcast=!1,"object"===c(r.simulcast)?o._simulcast=Object.assign({},h,r.simulcast):!0===r.simulcast&&(o._simulcast=Object.assign({},h)),o._transport=null,o._rtpParameters=null,o._locallyPaused=!o._track.enabled,o._remotelyPaused=!1,o._statsEnabled=!1,o._statsInterval=f,o._handleTrack(),o}var r,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,o.default),r=t,(n=[{key:"close",value:function(e){m.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){m.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return m.debug("send() [transport:%o]",e),this._closed?Promise.reject(new i.InvalidStateError("Producer closed")):this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==c(e)?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addProducer(this).then(function(){e.once("@close",function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))}),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)}).catch(function(e){throw t._transport=null,e}))}},{key:"pause",value:function(e){return m.debug("pause()"),this._closed?(m.error("pause() | Producer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){m.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return m.debug("resume()"),this._closed?(m.error("resume() | Producer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){m.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"replaceTrack",value:function(e){var t,r=this;if(m.debug("replaceTrack() [track:%o]",e),this._closed)return Promise.reject(new i.InvalidStateError("Producer closed"));if(!e)return Promise.reject(new TypeError("no track given"));if("ended"===e.readyState)return Promise.reject(new Error('track.readyState is "ended"'));try{t=e.clone()}catch(r){t=e}return Promise.resolve().then(function(){if(r._transport)return r._transport.replaceProducerTrack(r,t)}).then(function(){try{r._track.onended=null,r._track.stop()}catch(e){}return r.paused?t.enabled=!1:t.enabled=!0,r._originalTrack=e,r._track=t,r._handleTrack(),r._track})}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;m.debug("enableStats() [interval:%s]",e),this._closed?m.error("enableStats() | Producer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?f:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){m.debug("disableStats()"),this._closed?m.error("disableStats() | Producer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(m.warn('track "ended" event'),e.safeEmit("trackended"))}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}}])&&u(r.prototype,n),s&&u(r,s),t}();t.default=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(0)),o=i(r(2));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=new n.default("Peer"),p=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=c(this,u(t).call(this,l)))._name=e,n._closed=!1,n._appData=r,n._consumers=new Map,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o.default),r=t,(n=[{key:"close",value:function(){if(l.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,o=this._consumers.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(l.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._consumers.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:".concat(e.id,"]"));this._consumers.set(e.id,e),e.on("@close",function(){t._consumers.delete(e.id)}),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData}},{key:"consumers",get:function(){return Array.from(this._consumers.values())}}])&&s(r.prototype,n),i&&s(r,i),t}();t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(0)),o=a(r(2)),i=r(12);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=new Set(["default","low","medium","high"]),f=1e3,h=new n.default("Consumer"),m=function(e){function t(e,r,n,o,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=u(this,d(t).call(this,h)))._id=e,a._closed=!1,a._kind=r,a._rtpParameters=n,a._peer=o,a._appData=i,a._supported=!1,a._transport=null,a._track=null,a._locallyPaused=!1,a._remotelyPaused=!1,a._statsEnabled=!1,a._statsInterval=f,a._preferredProfile="default",a._effectiveProfile=null,a}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,o.default),r=t,(n=[{key:"close",value:function(){h.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){h.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(e){var t=this;return h.debug("receive() [transport:%o]",e),this._closed?Promise.reject(new i.InvalidStateError("Consumer closed")):this._supported?this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==s(e)?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addConsumer(this).then(function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once("@close",function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit("unhandled")}}),t.safeEmit("handled"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r}).catch(function(e){throw t._transport=null,e})):Promise.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return h.debug("pause()"),this._closed?(h.error("pause() | Consumer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){h.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return h.debug("resume()"),this._closed?(h.error("resume() | Consumer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){h.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){h.debug("setPreferredProfile() [profile:%s]",e),this._closed?h.error("setPreferredProfile() | Consumer closed"):e!==this._preferredProfile&&(p.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):h.error('setPreferredProfile() | invalid profile "%s"',e))}},{key:"remoteSetPreferredProfile",value:function(e){h.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){h.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;h.debug("enableStats() [interval:%s]",e),this._closed?h.error("enableStats() | Consumer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?f:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){h.debug("disableStats()"),this._closed?h.error("disableStats() | Consumer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}])&&c(r.prototype,n),a&&c(r,a),t}();t.default=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Logger",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"EnhancedEventEmitter",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"RemoteUnifiedPlanSdp",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"RemotePlanBSdp",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"RemotePlainRtpSdp",{enumerable:!0,get:function(){return f.default}}),t.sdpPlainRtpUtils=t.sdpPlanBUtils=t.sdpUnifiedPlanUtils=t.sdpCommonUtils=t.ortc=t.utils=void 0;var n=m(r(0)),o=m(r(2)),i=h(r(1));t.utils=i;var a=h(r(3));t.ortc=a;var s=h(r(5));t.sdpCommonUtils=s;var c=h(r(6));t.sdpUnifiedPlanUtils=c;var u=h(r(8));t.sdpPlanBUtils=u;var d=h(r(68));t.sdpPlainRtpUtils=d;var l=m(r(7)),p=m(r(9)),f=m(r(69));function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractPlainRtpParametersByKind=function(e,t){var r=(e.media||[]).find(function(e){return e.type===t});if(!r)throw new Error("m=".concat(t," section not found"));return{ip:e.connection.ip,port:r.port}},t.fillRtpParametersForKind=function(e,t,r){var n={cname:null,reducedSize:!0,mux:!0},o=(t.media||[]).find(function(e){return e.type===r});if(!o)throw new Error("m=".concat(r," section not found"));var i,a=(o.ssrcs||[]).find(function(e){return"cname"===e.attribute});a&&(i=a.id,n.cname=a.value);e.rtcp=n,e.encodings=[];var s={ssrc:i};e.encodings.push(s)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(4)),o=a(r(0)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(1));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var m=new o.default("RemotePlainRtpSdp"),y=function(){function e(t){p(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:i.randomNumber(),version:0}}return h(e,[{key:"setTransportLocalParameters",value:function(e){m.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){m.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}}]),e}(),v=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,y),h(t,[{key:"createAnswerSdp",value:function(e){if(m.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.plainRtpParameters,r={},o=(e.media||[]).filter(function(e){return e.hasOwnProperty("mid")}).map(function(e){return String(e.mid)});this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},r.name="-",r.timing={start:0,stop:0},r.msidSemantic={semantic:"WMS",token:"*"},o.length>0&&(r.groups=[{type:"BUNDLE",mids:o.join(" ")}]),r.media=[];var i=!0,a=!1,s=void 0;try{for(var c,u=(e.media||[])[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var d=c.value,l="inactive"===d.direction,p=d.type,f=this._rtpParametersByKind[p].codecs,h=this._rtpParametersByKind[p].headerExtensions,y={};switch(y.type=d.type,y.port=t.port,y.protocol="RTP/AVP",y.connection={ip:t.ip,version:t.version},y.mid=d.mid,d.direction){case"sendrecv":case"sendonly":y.direction="recvonly";break;case"recvonly":case"inactive":y.direction="inactive"}y.rtp=[],y.rtcpFb=[],y.fmtp=[];var v=!0,g=!1,b=void 0;try{for(var _,w=f[Symbol.iterator]();!(v=(_=w.next()).done);v=!0){var P=_.value,k={payload:P.payloadType,codec:P.name,rate:P.clockRate};if(P.channels>1&&(k.encoding=P.channels),y.rtp.push(k),P.parameters){for(var C={payload:P.payloadType,config:""},S=Object.keys(P.parameters),R=0;R<S.length;R++){var T=S[R];C.config&&(C.config+=";"),C.config+="".concat(T,"=").concat(P.parameters[T])}C.config&&y.fmtp.push(C)}if(P.rtcpFeedback){var O=!0,E=!1,x=void 0;try{for(var A,D=P.rtcpFeedback[Symbol.iterator]();!(O=(A=D.next()).done);O=!0){var j=A.value;y.rtcpFb.push({payload:P.payloadType,type:j.type,subtype:j.parameter||""})}}catch(e){E=!0,x=e}finally{try{O||null==D.return||D.return()}finally{if(E)throw x}}}}}catch(e){g=!0,b=e}finally{try{v||null==w.return||w.return()}finally{if(g)throw b}}if(y.payloads=f.map(function(e){return e.payloadType}).join(" "),!l){y.ext=[];var F=!0,I=!1,B=void 0;try{for(var L,M=function(){var e=L.value;if(!(d.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";y.ext.push({uri:e.uri,value:e.id})},U=h[Symbol.iterator]();!(F=(L=U.next()).done);F=!0)M()}catch(e){I=!0,B=e}finally{try{F||null==U.return||U.return()}finally{if(I)throw B}}}if(d.simulcast_03){y.simulcast_03={value:d.simulcast_03.value.replace(/send/g,"recv")},y.rids=[];var N=!0,q=!1,z=void 0;try{for(var G,Y=(d.rids||[])[Symbol.iterator]();!(N=(G=Y.next()).done);N=!0){var K=G.value;"send"===K.direction&&y.rids.push({id:K.id,direction:"recv"})}}catch(e){q=!0,z=e}finally{try{N||null==Y.return||Y.return()}finally{if(q)throw z}}}y.rtcpMux="rtcp-mux",y.rtcpRsize="rtcp-rsize",r.media.push(y)}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return n.default.write(r)}}]),t}(),g=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,y),h(t,[{key:"createOfferSdp",value:function(e){if(m.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.plainRtpParameters,r={},o=e.map(function(e){return String(e.mid)});this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},r.name="-",r.timing={start:0,stop:0},r.msidSemantic={semantic:"WMS",token:"*"},o.length>0&&(r.groups=[{type:"BUNDLE",mids:o.join(" ")}]),r.media=[];var i=!0,a=!1,s=void 0;try{for(var c,u=e[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var d=c.value,l=d.closed,p=d.kind,f=this._rtpParametersByKind[p].codecs,h=this._rtpParametersByKind[p].headerExtensions,y={};y.type=p,y.mid=d.mid,y.msid="".concat(d.streamId," ").concat(d.trackId),y.port=t.port,y.protocol="RTP/AVP",y.connection={ip:t.ip,version:t.version},y.direction=l?"inactive":"sendonly",y.rtp=[],y.rtcpFb=[],y.fmtp=[];var v=!0,g=!1,b=void 0;try{for(var _,w=f[Symbol.iterator]();!(v=(_=w.next()).done);v=!0){var P=_.value,k={payload:P.payloadType,codec:P.name,rate:P.clockRate};if(P.channels>1&&(k.encoding=P.channels),y.rtp.push(k),P.parameters){for(var C={payload:P.payloadType,config:""},S=Object.keys(P.parameters),R=0;R<S.length;R++){var T=S[R];C.config&&(C.config+=";"),C.config+="".concat(T,"=").concat(P.parameters[T])}C.config&&y.fmtp.push(C)}if(P.rtcpFeedback){var O=!0,E=!1,x=void 0;try{for(var A,D=P.rtcpFeedback[Symbol.iterator]();!(O=(A=D.next()).done);O=!0){var j=A.value;y.rtcpFb.push({payload:P.payloadType,type:j.type,subtype:j.parameter||""})}}catch(e){E=!0,x=e}finally{try{O||null==D.return||D.return()}finally{if(E)throw x}}}}}catch(e){g=!0,b=e}finally{try{v||null==w.return||w.return()}finally{if(g)throw b}}if(y.payloads=f.map(function(e){return e.payloadType}).join(" "),!l){y.ext=[];var F=!0,I=!1,B=void 0;try{for(var L,M=h[Symbol.iterator]();!(F=(L=M.next()).done);F=!0){var U=L.value;"urn:ietf:params:rtp-hdrext:sdes:mid"!==U.uri&&y.ext.push({uri:U.uri,value:U.id})}}catch(e){I=!0,B=e}finally{try{F||null==M.return||M.return()}finally{if(I)throw B}}}y.rtcpMux="rtcp-mux",y.rtcpRsize="rtcp-rsize",l||(y.ssrcs=[],y.ssrcGroups=[],y.ssrcs.push({id:d.ssrc,attribute:"cname",value:d.cname}),d.rtxSsrc&&(y.ssrcs.push({id:d.rtxSsrc,attribute:"cname",value:d.cname}),y.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(d.ssrc," ").concat(d.rtxSsrc)}))),r.media.push(y)}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return n.default.write(r)}}]),t}();t.default=function e(t,r){switch(p(this,e),m.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new v(r);case"recv":return new g(r)}}},function(e,t,r){var n=r(71),o=r(21),i=r(30),a=r(14)("socket.io-client");e.exports=t=c;var s=t.managers={};function c(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,o=n(e),c=o.source,u=o.id,d=o.path,l=s[u]&&d in s[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(a("ignoring socket cache for %s",c),r=i(c,t)):(s[u]||(a("new io instance for %s",c),s[u]=i(c,t)),r=s[u]),o.query&&!t.query&&(t.query=o.query),r.socket(o.path,t)}t.protocol=o.protocol,t.connect=c,t.Manager=r(30),t.Socket=r(36)},function(e,t,r){var n=r(27),o=r(14)("socket.io-client:url");e.exports=function(e,t){var r=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),o("parse %s",e),r=n(e));r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443"));r.path=r.path||"/";var i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}},function(e,t,r){function n(e){var r;function n(){if(n.enabled){var e=n,o=+new Date,i=o-(r||o);e.diff=i,e.prev=r,e.curr=o,r=o;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;c++;var o=t.formatters[n];if("function"==typeof o){var i=a[c];r=o.call(e,i),a.splice(c,1),c--}return r}),t.formatArgs.call(e,a),(n.log||t.log||console.log.bind(console)).apply(e,a)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),n.destroy=o,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var r;t.save(e),t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var i=t.instances[r];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(20),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,r){(function(n){function o(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(t=e.exports=r(74)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,n)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=o,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(o())}).call(this,r(13))},function(e,t,r){function n(e){var r;function n(){if(n.enabled){var e=n,o=+new Date,i=o-(r||o);e.diff=i,e.prev=r,e.curr=o,r=o;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;c++;var o=t.formatters[n];if("function"==typeof o){var i=a[c];r=o.call(e,i),a.splice(c,1),c--}return r}),t.formatArgs.call(e,a),(n.log||t.log||console.log.bind(console)).apply(e,a)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),n.destroy=o,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var r;t.save(e),t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var i=t.instances[r];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(20),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,r){var n=r(28),o=r(29),i=Object.prototype.toString,a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.deconstructPacket=function(e){var t=[],r=e.data,i=e;return i.data=function e(t,r){if(!t)return t;if(o(t)){var i={_placeholder:!0,num:r.length};return r.push(t),i}if(n(t)){for(var a=new Array(t.length),s=0;s<t.length;s++)a[s]=e(t[s],r);return a}if("object"==typeof t&&!(t instanceof Date)){var a={};for(var c in t)a[c]=e(t[c],r);return a}return t}(r,t),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,r){if(!t)return t;if(t&&t._placeholder)return r[t.num];if(n(t))for(var o=0;o<t.length;o++)t[o]=e(t[o],r);else if("object"==typeof t)for(var i in t)t[i]=e(t[i],r);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var r=0,i=e;!function e(c,u,d){if(!c)return c;if(a&&c instanceof Blob||s&&c instanceof File){r++;var l=new FileReader;l.onload=function(){d?d[u]=this.result:i=this.result,--r||t(i)},l.readAsArrayBuffer(c)}else if(n(c))for(var p=0;p<c.length;p++)e(c[p],p,c);else if("object"==typeof c&&!o(c))for(var f in c)e(c[f],f,c)}(i),r||t(i)}},function(e,t,r){"use strict";t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){for(var t,r=u(e),n=r[0],a=r[1],s=new i(function(e,t,r){return 3*(t+r)/4-r}(0,n,a)),c=0,d=a>0?n-4:n,l=0;l<d;l+=4)t=o[e.charCodeAt(l)]<<18|o[e.charCodeAt(l+1)]<<12|o[e.charCodeAt(l+2)]<<6|o[e.charCodeAt(l+3)],s[c++]=t>>16&255,s[c++]=t>>8&255,s[c++]=255&t;2===a&&(t=o[e.charCodeAt(l)]<<2|o[e.charCodeAt(l+1)]>>4,s[c++]=255&t);1===a&&(t=o[e.charCodeAt(l)]<<10|o[e.charCodeAt(l+1)]<<4|o[e.charCodeAt(l+2)]>>2,s[c++]=t>>8&255,s[c++]=255&t);return s},t.fromByteArray=function(e){for(var t,r=e.length,o=r%3,i=[],a=0,s=r-o;a<s;a+=16383)i.push(d(e,a,a+16383>s?s:a+16383));1===o?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===o&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)n[s]=a[s],o[a.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function d(e,t,r){for(var o,i,a=[],s=t;s<r;s+=3)o=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(i=o)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,o){var i,a,s=8*o-n-1,c=(1<<s)-1,u=c>>1,d=-7,l=r?o-1:0,p=r?-1:1,f=e[t+l];for(l+=p,i=f&(1<<-d)-1,f>>=-d,d+=s;d>0;i=256*i+e[t+l],l+=p,d-=8);for(a=i&(1<<-d)-1,i>>=-d,d+=n;d>0;a=256*a+e[t+l],l+=p,d-=8);if(0===i)i=1-u;else{if(i===c)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),i-=u}return(f?-1:1)*a*Math.pow(2,i-n)},t.write=function(e,t,r,n,o,i){var a,s,c,u=8*i-o-1,d=(1<<u)-1,l=d>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:i-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=d):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+l>=1?p/c:p*Math.pow(2,1-l))*c>=2&&(a++,c/=2),a+l>=d?(s=0,a=d):a+l>=1?(s=(t*c-1)*Math.pow(2,o),a+=l):(s=t*Math.pow(2,l-1)*Math.pow(2,o),a=0));o>=8;e[r+f]=255&s,f+=h,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;e[r+f]=255&a,f+=h,a/=256,u-=8);e[r+f-h]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){e.exports=r(80),e.exports.parser=r(11)},function(e,t,r){var n=r(31),o=r(10),i=r(17)("engine.io-client:socket"),a=r(35),s=r(11),c=r(27),u=r(15);function d(e,t){if(!(this instanceof d))return new d(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=c(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=c(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=d,d.priorWebsocketSuccess=!1,o(d.prototype),d.protocol=s.protocol,d.Socket=d,d.Transport=r(24),d.transports=r(31),d.parser=r(11),d.prototype.createTransport=function(e){i('creating transport "%s"',e);var t=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.query);t.EIO=s.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new n[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative})},d.prototype.open=function(){var e;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},d.prototype.setTransport=function(e){i("setting transport %s",e.name);var t=this;this.transport&&(i("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},d.prototype.probe=function(e){i('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function o(){if(n.onlyBinaryUpgrades){var o=!this.supportsBinary&&n.transport.supportsBinary;r=r||o}r||(i('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(o){if(!r)if("pong"===o.type&&"probe"===o.data){if(i('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;d.priorWebsocketSuccess="websocket"===t.name,i('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){r||"closed"!==n.readyState&&(i("changing transport and sending upgrade packet"),p(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush())})}else{i('probe transport "%s" failed',e);var a=new Error("probe error");a.transport=t.name,n.emit("upgradeError",a)}}))}function a(){r||(r=!0,p(),t.close(),t=null)}function s(r){var o=new Error("probe error: "+r);o.transport=t.name,a(),i('probe transport "%s" failed because of error: %s',e,r),n.emit("upgradeError",o)}function c(){s("transport closed")}function u(){s("socket closed")}function l(e){t&&e.name!==t.name&&(i('"%s" works - aborting "%s"',e.name,t.name),a())}function p(){t.removeListener("open",o),t.removeListener("error",s),t.removeListener("close",c),n.removeListener("close",u),n.removeListener("upgrading",l)}d.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",s),t.once("close",c),this.once("close",u),this.once("upgrading",l),t.open()},d.prototype.onOpen=function(){if(i("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){i("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},d.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(i('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else i('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},d.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){i("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},d.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(i("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},d.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var o={type:e,data:t,options:r};this.emit("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}},d.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}function t(){e.onClose("forced close"),i("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},d.prototype.onError=function(e){i("socket error %j",e),d.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},d.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){i('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},d.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~a(this.transports,e[r])&&t.push(e[r]);return t}},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,r){var n=r(23),o=r(32),i=r(10),a=r(16),s=r(17)("engine.io-client:polling-xhr");function c(){}function u(e){if(o.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,r=location.port;r||(r=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}function d(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(e.exports=u,e.exports.Request=d,a(u,o),u.prototype.supportsBinary=!0,u.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new d(e)},u.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),o=this;n.on("success",t),n.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=n},u.prototype.doPoll=function(){s("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},i(d.prototype),d.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new n(e),r=this;try{s("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&t.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");r.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout(function(){r.onError(t.status)},0))},s("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}"undefined"!=typeof document&&(this.index=d.requestsCount++,d.requests[this.index]=this)},d.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},d.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},d.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},d.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete d.requests[this.index],this.xhr=null}},d.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},d.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},d.prototype.abort=function(){this.cleanup()},d.requestsCount=0,d.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",p);else if("function"==typeof addEventListener){var l="onpagehide"in self?"pagehide":"unload";addEventListener(l,p,!1)}function p(){for(var e in d.requests)d.requests.hasOwnProperty(e)&&d.requests[e].abort()}},function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t){e.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(r-t),a=t,s=0;a<r;a++,s++)i[s]=o[a];return i.buffer}},function(e,t){function r(){}e.exports=function(e,t,n){var o=!1;return n=n||r,i.count=e,0===e?t():i;function i(e,r){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=n):0!==i.count||o||t(null,r)}}},function(e,t){
/*! https://mths.be/utf8js v2.1.2 by @mathias */
var r,n,o,i=String.fromCharCode;function a(e){for(var t,r,n=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function s(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(e,t){return i(e>>t&63|128)}function u(e,t){if(0==(4294967168&e))return i(e);var r="";return 0==(4294965248&e)?r=i(e>>6&31|192):0==(4294901760&e)?(s(e,t)||(e=65533),r=i(e>>12&15|224),r+=c(e,6)):0==(4292870144&e)&&(r=i(e>>18&7|240),r+=c(e,12),r+=c(e,6)),r+=i(63&e|128)}function d(){if(o>=n)throw Error("Invalid byte index");var e=255&r[o];if(o++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function l(e){var t,i;if(o>n)throw Error("Invalid byte index");if(o==n)return!1;if(t=255&r[o],o++,0==(128&t))return t;if(192==(224&t)){if((i=(31&t)<<6|d())>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&t)){if((i=(15&t)<<12|d()<<6|d())>=2048)return s(i,e)?i:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(i=(7&t)<<18|d()<<12|d()<<6|d())>=65536&&i<=1114111)return i;throw Error("Invalid UTF-8 detected")}e.exports={version:"2.1.2",encode:function(e,t){for(var r=!1!==(t=t||{}).strict,n=a(e),o=n.length,i=-1,s="";++i<o;)s+=u(n[i],r);return s},decode:function(e,t){var s=!1!==(t=t||{}).strict;r=a(e),n=r.length,o=0;for(var c,u=[];!1!==(c=l(s));)u.push(c);return function(e){for(var t,r=e.length,n=-1,o="";++n<r;)(t=e[n])>65535&&(o+=i((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=i(t);return o}(u)}}},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),o=n.length,i="";for(r=0;r<o;r+=3)i+=e[n[r]>>2],i+=e[(3&n[r])<<4|n[r+1]>>4],i+=e[(15&n[r+1])<<2|n[r+2]>>6],i+=e[63&n[r+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,n,o,i,a,s=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var d=new ArrayBuffer(s),l=new Uint8Array(d);for(t=0;t<c;t+=4)n=r[e.charCodeAt(t)],o=r[e.charCodeAt(t+1)],i=r[e.charCodeAt(t+2)],a=r[e.charCodeAt(t+3)],l[u++]=n<<2|o>>4,l[u++]=(15&o)<<4|i>>2,l[u++]=(3&i)<<6|63&a;return d}}()},function(e,t){var r=void 0!==r?r:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),o=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),i=r&&r.prototype.append&&r.prototype.getBlob;function a(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=r.buffer}return t}return e})}function s(e,t){t=t||{};var n=new r;return a(e).forEach(function(e){n.append(e)}),t.type?n.getBlob(t.type):n.getBlob()}function c(e,t){return new Blob(a(e),t||{})}"undefined"!=typeof Blob&&(s.prototype=Blob.prototype,c.prototype=Blob.prototype),e.exports=n?o?Blob:c:i?s:void 0},function(e,t,r){function n(e){var r;function n(){if(n.enabled){var e=n,o=+new Date,i=o-(r||o);e.diff=i,e.prev=r,e.curr=o,r=o;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;c++;var o=t.formatters[n];if("function"==typeof o){var i=a[c];r=o.call(e,i),a.splice(c,1),c--}return r}),t.formatArgs.call(e,a),(n.log||t.log||console.log.bind(console)).apply(e,a)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),n.destroy=o,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var r;t.save(e),t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var i=t.instances[r];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(20),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t,r){(function(t){var n=r(32),o=r(16);e.exports=d;var i,a=/\n/g,s=/\\n/g;function c(){}function u(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{}}function d(e){if(n.call(this,e),this.query=this.query||{},!i){var t=u();i=t.___eio=t.___eio||[]}this.index=i.length;var r=this;i.push(function(e){r.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){r.script&&(r.script.onerror=c)},!1)}o(d,n),d.prototype.supportsBinary=!1,d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},d.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},d.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,o=document.createElement("form"),i=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=c,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function u(){d(),t()}function d(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),d(),e=e.replace(s,"\\\n"),this.area.value=e.replace(a,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,r(19))},function(e,t,r){(function(t){var n,o,i=r(24),a=r(11),s=r(15),c=r(16),u=r(34),d=r(17)("engine.io-client:websocket");if("undefined"==typeof self)try{o=r(93)}catch(e){}else n=self.WebSocket||self.MozWebSocket;var l=n||o;function p(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=n&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(l=o),i.call(this,e)}e.exports=p,c(p,i),p.prototype.name="websocket",p.prototype.supportsBinary=!0,p.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new l(e,t):new l(e):new l(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},p.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},p.prototype.write=function(e){var r=this;this.writable=!1;for(var n=e.length,o=0,i=n;o<i;o++)!function(e){a.encodePacket(e,r.supportsBinary,function(o){if(!r.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),r.perMessageDeflate)("string"==typeof o?t.byteLength(o):o.length)<r.perMessageDeflate.threshold&&(i.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(o):r.ws.send(o,i)}catch(e){d("websocket closed before onclose event")}--n||s()})}(e[o]);function s(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}},p.prototype.onClose=function(){i.prototype.onClose.call(this)},p.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},p.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=u()),this.supportsBinary||(e.b64=1),(e=s.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},p.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===p.prototype.name)}}).call(this,r(22).Buffer)},function(e,t){},function(e,t){e.exports=function(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}}]);
//# sourceMappingURL=main.3e43b5b3cde7cb8c0f87.js.map